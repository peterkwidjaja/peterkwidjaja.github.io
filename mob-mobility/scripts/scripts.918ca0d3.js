"use strict";angular.module("oasApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngCookies","ui.bootstrap","angularFileUpload","infinite-scroll","highcharts-ng","angular-toArrayFilter"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$cookies","Session","USER_ROLES","AuthService",function(a,b,c,d,e,f){a.session=d,a.session.user=d.user,a.isAuthenticated=f.isAuthenticated,a.$on("$locationChangeStart",function(c,d){a.isAuthenticated()||"views/login.html"===d.templateUrl||(a.session.destroy(),b.path("/login"))}),a.$on("not_authenticated",function(){alert("Please login to continue."),a.session.destroy(),b.path("/login")})}]).value("THROTTLE_MILLISECONDS",1e3),angular.module("oasApp").controller("ManpowerCtrl",["$rootScope","$scope","$timeout",function(a,b){var c=new Date,d=c.getDate(),e=c.getMonth()+1,f=c.getFullYear();10>e&&(e="0"+e),10>d&&(d="0"+d),b.today=f+"-"+e+"-"+d,b.changeTab=function(c){switch("profiles"!==c&&"attendance"!==c&&"salary"!==c&&"allocation"!==c&&(c="profiles"),b.activeTab=c,b.lastViewed.activeTab=c,console.log("changeTab called : ",b.lastViewed.activeTab),b.searchQuery=null,a.$broadcast("tab_changed",c),c){case"profiles":a.$broadcast("update_profiles");break;case"attendance":a.$broadcast("update_attendance");break;case"salary":a.$broadcast("update_salary");break;case"allocation":a.$broadcast("update_allocation");break;default:b.lastViewed.activeTab="profiles",a.$broadcast("update_profiles")}},b.$on("panel_changed",function(a,c){"manpower"===c&&b.changeTab(b.lastViewed.activeTab)}),b.searchKeypressed=function(a,c,d){13===a.charCode&&b.queryEmployee(c,d)},b.queryEmployee=function(b,c){a.$broadcast(b+"_search",c)}}]).directive("manpowerTab",function(){return{templateUrl:"views/manpower.html"}}),angular.module("oasApp").controller("ProjectsCtrl",["$rootScope","$scope","$modal","ProjectsService",function(a,b,c,d){var e=new Date,f=e.getDate(),g=e.getMonth()+1,h=e.getFullYear();10>g&&(g="0"+g),10>f&&(f="0"+f),b.today=h+"-"+g+"-"+f,b.projectsService=d,b.projectsService.projects=d.projects,b.changeTab=function(c){switch("laborcost"!==c&&"materialscost"!==c&&"projectscost"!==c&&(c="laborcost"),b.activeTab=c,b.lastViewed.activeTab=c,a.$broadcast("tab_changed",c),c){case"laborcost":a.$broadcast("update_laborcost",!0);break;case"materialscost":a.$broadcast("update_materialscost",!0);break;case"projectscost":a.$broadcast("update_costsummary",!0);break;default:b.lastViewed.activeTab="laborcost",a.$broadcast("update_laborcost",!0)}},b.refreshTab=function(){switch(b.activeTab){case"laborcost":a.$broadcast("update_laborcost",!0);break;case"materialscost":a.$broadcast("update_materialscost",!0);break;case"projectscost":a.$broadcast("update_costsummary",!0);break;default:a.$broadcast("update_laborcost",!0)}},b.$on("update_projects",function(){console.log("update projects"),b.showProjectsList=!0,b.selectedProject=null,b.projectsService.getProjects(b.session.user)}),b.$on("panel_changed",function(c,d){"projects"===d&&setTimeout(function(){a.$broadcast("update_projects"),b.changeTab(b.lastViewed.activeTab)},100)}),b.showProjectsList=!0,b.selectedProject=null,b.editProject=!1,b.selectProject=function(a){b.showProjectsList=!1,b.selectedProject=$.grep(b.projectsService.projects,function(b){return b.id===a})[0],b.projectsService.getProjectDetails(a,b.session.user).then(function(a){b.selectedProject=a}),b.refreshTab()},b.updateProject=function(c){d.updateProject(c,b.session.user).then(function(c){if(console.log("updateProject done",c),"success"===c.result)return b.editProject=!1,void a.$broadcast("update_projects",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.deleteProject=function(d){console.log(d);var e=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"project"}}}});e.result.then(function(c){c&&(console.log("Deleting project : ",d),b.projectsService.deleteProject(d,b.session.user).then(function(c){if(console.log("delete project done",c),"success"===c.result)return b.changeTab("laborcost"),void a.$broadcast("update_projects",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}}))})},b.showNewProjectModal=function(){var d=c.open({templateUrl:"views/modal/createproject.html",controller:"CreateprojectCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center createproject-modal"});d.result.then(function(c){console.log("creating new project: ",c),b.projectsService.createProject(c,b.session.user).then(function(c){if(console.log("create new project done",c),"success"===c.result)return console.log("Success response : ",c),void a.$broadcast("update_projects");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})})}}]).directive("projectsTab",function(){return{templateUrl:"views/projects.html"}}),angular.module("oasApp").controller("LoginCtrl",["$rootScope","$scope","$modal","$timeout","$location","AUTH_EVENTS","AuthService",function(a,b,c,d,e,f,g){var h=function(a,b){c.open({templateUrl:"views/modal/errormodal.html",controller:"ErrormodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center error-modal",resolve:{modalInfo:function(){return{isNotification:b,errors:a}}}})};b.credentials={email:"",password:""},b.login=function(b){g.login(b).then(function(c){"success"===c.result?(c.data.email=b.email,a.session.create(c.data)):h(c.data)})},b.forgotpassword=function(){var a=c.open({templateUrl:"views/modal/forgotpassword.html",controller:"ForgotpasswordCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center forgotpassword-modal"});a.result.then(function(a){g.forgotPassword(a).then(function(a){if("success"===a.result)return console.log("Success response : ",a),void h(["A new password will be sent to this email address"],!0);switch(a.status){case 422:console.error("422: ",a.data),h(a.data,!1)}})})},b.generalsettings=function(){var a=c.open({templateUrl:"views/modal/generalsettingsmodal.html",controller:"GeneralsettingsmodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas generalsettings-modal"});a.result.then(function(){})},b.$on("session_created",function(a,c){e.path("/dashboard"),c||b.generalsettings()})}]).directive("login",function(){return{templateUrl:"views/login.html"}}),angular.module("oasApp").controller("DashboardCtrl",["$rootScope","$scope","$location","$timeout","$modal",function(a,b,c,d,e){b.session.user=a.session.user,b.lastViewed={},b.lastViewed=angular.fromJson(localStorage.lastViewed),b.firstLoad=!0,b.$watch("lastViewed.activePanel",function(){localStorage.lastViewed=angular.toJson(b.lastViewed)}),b.$watch("lastViewed.activeTab",function(){localStorage.lastViewed=angular.toJson(b.lastViewed)}),b.loading=!1,b.$on("loading",function(a,c){b.loading=c}),b.isEquals=function(a,b){return a===b},b.changePanel=function(c){console.log("panel : ",c),console.log("tab : ",b.lastViewed.activeTab),b.activePanel=c,b.lastViewed.activePanel=c,a.$broadcast("panel_changed",c)},a.isAuthenticated&&(console.log("restoring session"),setTimeout(function(){a.session.restoreSession()},1e3)),b.$on("session_restored",function(){console.log("Session restored: ",b.session.user),d(function(){b.changePanel(b.lastViewed.activePanel)})}),b.refreshApp=function(){window.location.reload()},b.launchErrorModal=function(a){e.open({templateUrl:"views/modal/errormodal.html",controller:"ErrormodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center error-modal",resolve:{modalInfo:function(){return{errors:a}}}})},b.logout=function(){console.log("Logout"),b.session.destroy(),c.path("/login")}}]),angular.module("oasApp").controller("ProfilesCtrl",["$rootScope","$scope","$modal","$filter","ManpowerService",function(a,b,c,d,e){var f=function(a){a===b.currentParams.page?(console.log("current profiles limit reached"),b.enableInfiniteScroll.current=!1):b.enableInfiniteScroll.current=!0},g=function(a){a===b.archiveParams.page?(console.log("archive profiles limit reached"),b.enableInfiniteScroll.archive=!1):b.enableInfiniteScroll.archive=!0};b.firstLoad=!0,b.enableInfiniteScroll={current:!1,archive:!1},b.currentParams={name:void 0,name_start_with:void 0,page:1},b.archiveParams={name:void 0,name_start_with:void 0,page:1},b.manpowerService=e,b.manpowerService.profiles=e.profiles,b.manpowerService.profilesArchived=e.profilesArchived,b.viewtype="current",b.newProfile=!1,b.$on("tab_changed",function(){}),b.$on("update_profiles",function(c,d){console.log("update_profiles triggered",d),(d||b.firstLoad)&&(b.firstLoad=!1,a.$broadcast("alphabetlist_reset"),b.enableInfiniteScroll={current:!1,archive:!1},b.currentParams={name:void 0,name_start_with:void 0,page:1},b.archiveParams={name:void 0,name_start_with:void 0,page:1},b.newProfile=!1,b.manpowerService.getProfiles(b.session.user,b.currentParams).then(f),b.manpowerService.getProfilesArchived(b.session.user,b.archiveParams).then(g))}),b.$on("profiles_search",function(a,c){switch(b.enableInfiniteScroll={current:!1,archive:!1},b.viewtype){case"current":b.currentParams.name=c,b.currentParams.page=1,b.manpowerService.getProfiles(b.session.user,b.currentParams).then(f);break;case"archive":b.archiveParams.name=c,b.archiveParams.page=1,b.manpowerService.getProfilesArchived(b.session.user,b.archiveParams).then(g)}}),b.$on("profiles_current_alphabet_changed",function(a,c){b.currentParams.name_start_with=c,b.currentParams.page=1,b.enableInfiniteScroll.current=!1,b.manpowerService.getProfiles(b.session.user,b.currentParams).then(f)}),b.$on("profiles_archive_alphabet_changed",function(a,c){b.archiveParams.name_start_with=c,b.archiveParams.page=1,b.enableInfiniteScroll.archive=!1,b.manpowerService.getProfilesArchived(b.session.user,b.archiveParams).then(g)}),b.nextPage=function(){switch(b.viewtype){case"current":if(!b.enableInfiniteScroll.current)return;b.currentParams.page+=1,b.manpowerService.getProfiles(b.session.user,b.currentParams).then(f);break;case"archive":if(!b.enableInfiniteScroll.archive)return;b.archiveParams.page+=1,b.manpowerService.getProfilesArchived(b.session.user,b.archiveParams).then(g)}},b.deleteProfileConfirmation=function(e){var f=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"profile"}}}});f.result.then(function(c){c&&b.manpowerService.deleteProfile(e,b.session.user).then(function(c){if("success"!==c.result)switch(c.status){case 500:console.error("500: ",c.data),b.launchErrorModal(["Internal server error"]);break;case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}else{console.log("profile deleted :",e);var f,g;switch(b.viewtype){case"current":f=d("filter")(b.manpowerService.profiles,{id:e}),g=b.manpowerService.profiles.indexOf(f[0]),b.manpowerService.profiles.splice(g,1);break;case"archive":f=d("filter")(b.manpowerService.profilesArchived,{id:e}),g=b.manpowerService.profilesArchived.indexOf(f[0]),b.manpowerService.profilesArchived.splice(g,1)}}})})},b.archive=function(c){console.log("archiving employee with id : ",c),b.manpowerService.archiveProfile(c,b.session.user).then(function(c){if(console.log("archive profile done",c),"success"===c.result)return void a.$broadcast("update_profiles",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.unarchive=function(c){console.log("unarchiving employee with id : ",c),b.manpowerService.unarchiveProfile(c,b.session.user).then(function(c){if(console.log("unarchive profile done",c),"success"===c.result)return void a.$broadcast("update_profiles",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("manpowerProfiles",function(){return{templateUrl:"views/profiles.html"}}),angular.module("oasApp").controller("AllocationCtrl",["$rootScope","$scope","AllocationService",function(a,b,c){var d=!1,e=function(a){a===b.normalParams.page?(console.log("normal allocation limit reached"),b.enableInfiniteScroll.normal=!1):b.enableInfiniteScroll.normal=!0},f=function(a){a===b.overtimeParams.page?(console.log("overtime allocation limit reached"),b.enableInfiniteScroll.overtime=!1):b.enableInfiniteScroll.overtime=!0};b.firstLoad=!0,b.enableInfiniteScroll={normal:!1,overtime:!1},b.normalParams={month:b.today,type:0,page:1},b.overtimeParams={month:b.today,type:1,page:1},b.allocationService=c,b.allocationService.normal=c.normal,b.allocationService.overtime=c.overtime,b.viewtype="normal-allocation",b.$on("tab_changed",function(){$(".allocation-normal").scrollTop(0),$(".allocation-overtime").scrollTop(0),b.enableInfiniteScroll={normal:!1,overtime:!1}}),b.$watch("allocationDate",function(a,c){if(void 0!==c&&d){if(console.log("allocationDate changed : ",a,c),""===a)return void(a=c);if("object"==typeof a){var g=new Date(a),h=g.getDate(),i=g.getMonth()+1,j=g.getFullYear();10>i&&(i="0"+i),10>h&&(h="0"+h),a=j+"-"+i+"-"+h}$(".allocation-normal").scrollTop(0),$(".allocation-overtime").scrollTop(0),b.normalParams.month=a,b.overtimeParams.month=a,b.normalParams.page=1,b.overtimeParams.page=1,b.allocationService.getNormalAllocations(b.normalParams,b.session.user).then(e),b.allocationService.getOvertimeAllocations(b.overtimeParams,b.session.user).then(f)}}),b.$on("update_allocation",function(c,g){console.log("update_allocation triggered"),(g||b.firstLoad)&&(b.firstLoad=!1,a.$broadcast("alphabetlist_reset"),b.enableInfiniteScroll={normal:!1,overtime:!1},b.normalParams={month:b.today,type:0,page:1},b.overtimeParams={month:b.today,type:1,page:1},b.allocationDate=b.today,d=!0,b.allocationService.getNormalAllocations(b.normalParams,b.session.user).then(e),b.allocationService.getOvertimeAllocations(b.overtimeParams,b.session.user).then(f))}),b.nextPage=function(){switch(b.viewtype){case"normal-allocation":if(!b.enableInfiniteScroll.normal)return;b.normalParams.page+=1,b.allocationService.getNormalAllocations(b.normalParams,b.session.user).then(e);break;case"overtime-allocation":if(!b.enableInfiniteScroll.overtime)return;b.overtimeParams.page+=1,b.allocationService.getOvertimeAllocations(b.overtimeParams,b.session.user).then(f)}},b.datepickers={allocationDate:!1},b.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},b.open=function(a){a.preventDefault(),a.stopPropagation();var c={allocationDate:!1};angular.copy(c,b.datepickers),b.datepickers[a.target.name]=!0},b.shiftMonth=function(a){var c,d,e,f=typeof b.allocationDate,g=b.allocationDate,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setMonth(h.getMonth()+a),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),b.allocationDate=e+"-"+d+"-"+c}}]).directive("manpowerAllocation",function(){return{templateUrl:"views/allocation.html"}}),angular.module("oasApp").controller("SalaryCtrl",["$rootScope","$scope","$filter","PrinterService","SalaryService",function(a,b,c,d,e){var f=function(a){a===b.dailyParams.page?(console.log("daily salary limit reached"),b.enableInfiniteScroll.daily=!1):b.enableInfiniteScroll.daily=!0},g=function(a){a===b.monthlyParams.page?(console.log("monthly salary limit reached"),b.enableInfiniteScroll.monthly=!1):b.enableInfiniteScroll.monthly=!0};b.firstLoad=!0,b.enableInfiniteScroll={daily:!1,monthly:!1},b.dailyParams={date:b.today,name:void 0,name_start_with:void 0,page:1},b.monthlyParams={month:b.today,name:void 0,name_start_with:void 0,page:1},b.printArray=[];var h=!1;b.salaryService=e,b.salary=e.salary,b.$watch("dailyParams.date",function(a,c){if(h){if(console.log("salary day changed : ",a,c),""===a)return void(a=c);if("object"==typeof a){var d=new Date(a),e=d.getDate(),g=d.getMonth()+1,i=d.getFullYear();10>g&&(g="0"+g),10>e&&(e="0"+e),a=i+"-"+g+"-"+e}$(".salary-daily").scrollTop(0),b.dailyParams.page=1,b.salaryService.getDailySalary(b.dailyParams,b.session.user).then(f)}}),b.$watch("monthlyParams.month",function(a,c){if(h){if(console.log("salary month changed : ",a,c),""===a)return void(a=c);if("object"==typeof a){var d=new Date(a),e=d.getDate(),f=d.getMonth()+1,i=d.getFullYear();10>f&&(f="0"+f),10>e&&(e="0"+e),a=i+"-"+f+"-"+e}$(".salary-monthly").scrollTop(0),b.monthlyParams.page=1,b.salaryService.getMonthlySalary(b.monthlyParams,b.session.user).then(g)}}),b.$on("tab_changed",function(){}),b.$on("update_salary",function(c,d){console.log("update_salary triggered",d),(d||b.firstLoad)&&(b.firstLoad=!1,a.$broadcast("alphabetlist_reset"),$(".salary-daily").scrollTop(0),$(".salary-monthly").scrollTop(0),b.enableInfiniteScroll={daily:!1,monthly:!1},b.dailyParams={date:b.today,name:void 0,name_start_with:void 0,page:1},b.monthlyParams={month:b.today,name:void 0,name_start_with:void 0,page:1},h=!0,b.salaryService.getDailySalary(b.dailyParams,b.session.user).then(f),b.salaryService.getMonthlySalary(b.monthlyParams,b.session.user).then(g))}),b.$on("salary_search",function(a,c){switch(console.log("search_changed triggered : ",c),b.enableInfiniteScroll={daily:!1,monthly:!1},b.viewtype){case"daily":b.dailyParams.name=c,b.dailyParams.page=1,b.salaryService.getDailySalary(b.dailyParams,b.session.user).then(f);break;case"monthly":b.monthlyParams.name=c,b.monthlyParams.page=1,b.salaryService.getMonthlySalary(b.monthlyParams,b.session.user).then(g)}}),b.$on("salary_daily_alphabet_changed",function(a,c){b.dailyParams.name_start_with=c,b.dailyParams.page=1,b.enableInfiniteScroll.daily=!0,b.salaryService.getDailySalary(b.dailyParams,b.session.user).then(f)}),b.$on("salary_monthly_alphabet_changed",function(a,c){b.monthlyParams.name_start_with=c,b.monthlyParams.page=1,b.enableInfiniteScroll.monthly=!0,b.salaryService.getMonthlySalary(b.monthlyParams,b.session.user).then(g)}),b.$on("print_add_employee",function(a,c){var d=b.printArray.indexOf(c);-1===d?b.printArray.push(c):b.printArray.splice(d,1)}),b.nextPage=function(){switch(b.viewtype){case"daily":if(!b.enableInfiniteScroll.daily)return;b.dailyParams.page+=1,b.salaryService.getDailySalary(b.dailyParams,b.session.user).then(f);break;case"monthly":if(!b.enableInfiniteScroll.monthly)return;console.log("monthly nextPage"),b.monthlyParams.page+=1,b.salaryService.getMonthlySalary(b.monthlyParams,b.session.user).then(g)}},b.viewtype="daily",b.salarymode="live",b.editMode=!1,b.printAllSalary=function(){var a={},c={month:b.monthlyParams.month,name:void 0,name_start_with:void 0,page:0},e=new Date(c.month),f=e.getMonth()+1,g=e.getFullYear(),h=new Date(g,f,0).getDate(),i=b.salary.monthly[0].sixteenDays,j=b.salary.monthly[0].remainingDaysInMonth;b.salaryService.getAllMonthlySalary(c,b.session.user).then(function(b){b.map(function(a){a.sixteenDays=i,a.remainingDaysInMonth=j,a.records=[];for(var b,c,d,e=a.dates,f=0;h>f;f++)b=f+1,b=10>b?"0"+b:""+b,a.records[f]={day:b,overtime_hour_count:"-",projects_abbrev_name:"-"};for(var g=0,k=e.length;k>g;g++)d=e[g],c=Number(d.date),a.records[c-1]={day:d.date,overtime_hour_count:d.overtime_hour_count,projects_abbrev_name:d.projects_abbrev_name}}),a.printArray=b,console.log("printAllSalary array : ",a),d.print("views/printtemplate.html",a)})},b.printSelectedSalary=function(){var a={};return 0===b.printArray.length?void alert("No employees selected for printing."):(a.printArray=b.printArray,d.print("views/printtemplate.html",a),void b.salary.monthly.map(function(a){a.selectedForPrinting=!1}))},b.printSingle=function(a){var e=[],f={};e=c("filter")(b.salary.monthly,function(b){return b.id===a}),f.printArray=e,d.print("views/printtemplate.html",f),b.salary.monthly.map(function(a){a.selectedForPrinting=!1})},b.datepickers={salaryDate:!1},b.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},b.open=function(a){a.preventDefault(),a.stopPropagation();var c={salaryDate:!1};angular.copy(c,b.datepickers),b.datepickers[a.target.name]=!0},b.shiftDay=function(a){var c,d,e,f=typeof b.dailyParams.date,g=b.dailyParams.date,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setDate(h.getDate()+a),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),b.dailyParams.date=e+"-"+d+"-"+c},b.shiftMonth=function(a){var c,d,e,f=typeof b.monthlyParams.month,g=b.monthlyParams.month,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setMonth(h.getMonth()+a),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),b.monthlyParams.month=e+"-"+d+"-"+c}}]).directive("manpowerSalary",function(){return{templateUrl:"views/salary.html"}}),angular.module("oasApp").controller("AttendanceCtrl",["$rootScope","$scope","$modal","AttendanceService","SettingsService","ProjectsService",function(a,b,c,d,e,f){var g=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],h=function(a){a===b.attendanceParams.page||0===a?(console.log("attendance limit reached"),b.enableInfiniteScroll=!1):(b.enableInfiniteScroll=!0,i=!0)},i=!1;b.firstLoad=!0,b.enableInfiniteScroll=!1,b.attendanceParams={name:void 0,name_start_with:void 0,page:1,project_id:void 0},b.attendanceService=d,b.attendanceService.attendances=d.attendances,b.projectsService=f,b.projectsService.projects=f.projects,b.settingsService=e,b.settingsService.settings=e.settings,b.$watch("attendanceDate",function(a,c){if(void 0!==c&&i){if(console.log("attendanceDate changed : ",a,c),""===a)return void(a=c);if("object"==typeof a){var d=new Date(a),e=d.getDate(),f=d.getMonth()+1,j=d.getFullYear();10>f&&(f="0"+f),10>e&&(e="0"+e),a=j+"-"+f+"-"+e,b.attendanceParams.page=1,$(".attendance-list").scrollTop(0),b.attendanceDate=a,b.attendanceMonth=g[Number(a.substr(5,2))-1],b.attendanceService.getAttendances(a,b.attendanceParams,b.session.user).then(h)}else b.attendanceParams.page=1,$(".attendance-list").scrollTop(0),b.attendanceService.getAttendances(b.attendanceDate,b.attendanceParams,b.session.user).then(h)}}),b.$on("update_attendance",function(c,d){console.log("update_attendance triggered",d,b.session.user),(d||b.firstLoad)&&(b.firstLoad=!1,a.$broadcast("alphabetlist_reset"),$(".attendance-list").scrollTop(0),b.enableInfiniteScroll=!1,b.attendanceDate=b.today,b.attendanceMonth=g[Number(b.attendanceDate.substr(5,2))-1],b.selectedProject="All projects",b.attendanceParams={name:void 0,name_start_with:void 0,page:1,project_id:void 0},i=!0,b.projectsService.getProjects(b.session.user),b.settingsService.getSettings(b.session.user),b.attendanceService.getAttendances(b.attendanceDate,b.attendanceParams,b.session.user).then(h),b.selectedEntryId=-1)}),b.$on("attendance_search",function(a,c){$(".attendance-list").scrollTop(0),b.enableInfiniteScroll=!1,b.attendanceParams.name=c,b.attendanceParams.page=1,b.attendanceService.getAttendances(b.attendanceDate,b.attendanceParams,b.session.user).then(h)}),b.$on("attendance_alphabet_changed",function(a,c){$(".attendance-list").scrollTop(0),b.enableInfiniteScroll=!1,b.attendanceParams.name_start_with=c,b.attendanceParams.page=1,b.attendanceService.getAttendances(b.attendanceDate,b.attendanceParams,b.session.user).then(h)}),b.nextPage=function(){console.log("attendance nextPage",b.enableInfiniteScroll),b.enableInfiniteScroll&&(b.attendanceParams.page+=1,b.attendanceService.getAttendances(b.attendanceDate,b.attendanceParams,b.session.user).then(h))},b.createEntry=function(a,d,e){var f=c.open({templateUrl:"views/modal/createentry.html",controller:"CreateentryCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center attendanceentry-modal",resolve:{modalInfo:function(){return{newEntryDate:b.attendanceDate,employeeId:a,startTime:b.settingsService.settings.work_start_at,projects:b.projectsService.projects}}}});f.result.then(function(a){b.confirmCreateEntry(a,d,e)})},b.confirmCreateEntry=function(d,e,f){var g=c.open({templateUrl:"views/modal/createentryconfirmation.html",controller:"CreateentryconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center createentryconfirmation-modal",resolve:{modalInfo:function(){return{type:d.type_code,name:e,avatar:f}}}});g.result.then(function(c){c&&b.attendanceService.createAttendance(d,d.employeeId,b.session.user).then(function(c){if(console.log("create attendance done",c),"success"===c.result)return console.log("Success response : ",c),console.log("newEntryParams : ",d),void b.attendanceService.insertSingleAttendance(d.employeeId,c.data);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})})},b.selectedEntryId=-1,b.defaultAvatarPath="images/manpower/avatar.png",b.setSelectedEntryId=function(a){b.selectedEntryId===a&&(a=-1),b.selectedEntryId=a},b.deleteEntryConfirmation=function(d){var e=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"entry"}}}});e.result.then(function(c){c&&b.attendanceService.deleteAttendance(d,b.session.user).then(function(){a.$broadcast("update_attendance")})})},b.editEntry=function(d,e){console.log("editEntry : ",d,e);var f=c.open({templateUrl:"views/modal/editentry.html",controller:"EditentryCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center attendanceentry-modal",resolve:{modalInfo:function(){return{entry:d,entryDate:b.attendanceDate,startTime:b.settingsService.settings.work_start_at,projects:b.projectsService.projects}}}});f.result.then(function(c){b.attendanceService.updateAttendance(c,b.session.user).then(function(c){if("success"===c.result)return void b.attendanceService.refreshSingleAttendance(e,c.data);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})})},b.showEntryDetails=function(a,b){c.open({templateUrl:"views/modal/attendancelocationmodal.html",controller:"AttendancelocationmodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center attendanceentry-modal",resolve:{modalInfo:function(){return{entry:a,type:b}}}})},b.selectedProject="All projects",b.chooseProject=function(c,d){b.attendanceParams.project_id=0===c?void 0:c,a.$broadcast("alphabetlist_reset"),$(".attendance-list").scrollTop(0),b.enableInfiniteScroll=!1,b.attendanceParams.page=1,b.attendanceParams.name=void 0,b.attendanceParams.name_start_with=void 0,b.attendanceService.getAttendances(b.attendanceDate,b.attendanceParams,b.session.user).then(h),b.selectedProject=d},b.showAttendanceSummary=function(d,e,f){console.log("In showAttendanceSummary :",d,e,f),b.attendanceService.getEmployeeAttendanceSummary(d.id,f,b.session.user).then(function(f){if(console.log("getEmployeeAttendanceSummary done. Response : ",f),"success"===f.result){c.open({templateUrl:"views/modal/attendancesummarymodal.html",controller:"AttendancesummarymodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center attendancesummary-modal",resolve:{modalInfo:function(){return{employee:d,month:e,year:b.attendanceDate.substr(0,4),data:f.data}}}})}else switch(f.status){case 422:console.error("422: ",f.data),b.launchErrorModal(f.data);break;case 401:a.$broadcast("not_authenticated")}})},b.datepickers={attendanceDate:!1},b.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},b.open=function(a){console.log(b.settingsService.settings),a.preventDefault(),a.stopPropagation();var c={attendanceDate:!1};angular.copy(c,b.datepickers),b.datepickers[a.target.name]=!0},b.shiftDay=function(a){console.log("shiftDay",a);var c,d,e,f=typeof b.attendanceDate,g=b.attendanceDate,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setDate(h.getDate()+a),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),b.attendanceDate=e+"-"+d+"-"+c}}]).directive("manpowerAttendance",function(){return{templateUrl:"views/attendance.html"}}),angular.module("oasApp").controller("SettingsCtrl",["$rootScope","$scope","SettingsService",function(a,b,c){b.settingsService=c,b.settingsService.settings=c.settings,b.changeTab=function(c){switch("general"!==c&&"personal"!==c&&"accounts"!==c&&"materials"!==c&&"accessories"!==c&&(c="general"),b.activeTab=c,b.lastViewed.activeTab=c,console.log("changeTab called : ",b.lastViewed.activeTab),a.$broadcast("tab_changed",c),c){case"general":a.$broadcast("update_settings",!0);break;case"personal":a.$broadcast("update_personalsettings",!0);break;case"accounts":a.$broadcast("update_accountsettings",!0);break;case"materials":a.$broadcast("update_materialsettings",!0);break;case"accessories":a.$broadcast("update_accessorysettings",!0);break;default:b.lastViewed.activeTab="general",a.$broadcast("update_generalsettings",!0)}},b.queryMaterial=function(b){a.$broadcast("materials_search",b)},b.queryAccessory=function(b){a.$broadcast("accessories_search",b)},b.$on("panel_changed",function(a,c){"settings"===c&&setTimeout(function(){b.changeTab(b.lastViewed.activeTab)},100)}),b.$on("update_settings",function(){console.log("update_settings triggered"),b.settingsService.getSettings(b.session.user)})}]).directive("settingsTab",function(){return{templateUrl:"views/settings.html"}}),angular.module("oasApp").controller("GeneralsettingsCtrl",["$rootScope","$scope","SettingsService",function(a,b){b.save=function(){console.log("Updating settings"),b.settingsService.updateSettings(b.settingsService.settings,b.session.user).then(function(c){if("success"===c.result)return void a.$broadcast("update_settings");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("settingsGeneral",function(){return{templateUrl:"views/generalsettings.html"}}),angular.module("oasApp").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),angular.module("oasApp").constant("USER_ROLES",{all:"*",admin:"admin",user:"user"}),angular.module("oasApp").factory("AuthService",["$http","$location","$cookies","Session","HTTP_PARAMS",function(a,b,c,d,e){var f="";f="mobility.oaspainting.com"===b.host()?e.prodApi:e.devApi;var g=function(a){var b={};return b.result="success",b.data=a.data,b},h=function(a){var b={};return b.result="failure",b.status=a.status,b.data=a.data.errors,b},i={};return i.login=function(b){return console.log("In authservice login"),a({method:"POST",url:f+"sessions",headers:{"X-APP-SECRET":e.appSecret},params:{email:b.email,password:b.password}}).then(g,h)},i.userInfo=function(b,c){return console.log("In authservice userinfo"),a({method:"GET",url:f+"sessions",headers:{"X-USER-ID":b,"X-USER-TOKEN":c}}).then(function(a){return a.data
})},i.isAuthenticated=function(){return!!c.authToken},i.isAuthorized=function(a){return angular.isArray(a)||(a=[a]),i.isAuthenticated()&&-1!==a.indexOf(d.userRole)},i.forgotPassword=function(b){return console.log("In authservice forgotPassword",b),a({method:"POST",url:f+"forgot_passwords",headers:{"X-APP-SECRET":e.appSecret},data:{email:b}}).then(g,h)},i}]),angular.module("oasApp").factory("ManpowerService",["$http","$upload","AuthService","ApiHandlerService",function(a,b,c,d){var e=d.getUrlPrefix(),f={};return f.profiles=[],f.profilesArchived=[],f.getProfiles=function(b,g){return console.log("In manpowerService profiles",g),void 0===b&&c.retrieveSession(),d.triggerLoading(),a({method:"GET",url:e+"employees",headers:{"X-USER-ID":b.id,"X-USER-TOKEN":b.authToken},params:g}).then(function(a){if(g.page>1){var b=f.profiles.concat(a.data.employees);angular.copy(b,f.profiles)}else angular.copy(a.data.employees,f.profiles);return d.triggerLoaded(),a.data.num_pages})},f.getProfilesArchived=function(b,g){return console.log("In manpowerService getProfilesArchived",g),void 0===b&&c.retrieveSession(),d.triggerLoading(),a({method:"GET",url:e+"employees/archives",headers:{"X-USER-ID":b.id,"X-USER-TOKEN":b.authToken},params:g}).then(function(a){if(g.page>1){var b=f.profilesArchived.concat(a.data.employees);angular.copy(b,f.profilesArchived)}else angular.copy(a.data.employees,f.profilesArchived);return d.triggerLoaded(),a.data.num_pages})},f.createProfile=function(a,c){var f={};return console.log("In manpowerService.createProfile",a),d.triggerLoading(),f={method:"POST",url:e+"employees/",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:JSON.parse(angular.toJson(a.formDetails))},0!==a.file.length&&(f.file=a.file[0],f.fileFormDataName="avatar"),b.upload(f).then(d.successResponse,d.errorResponse)},f.updateProfile=function(a,c){var f={};return console.log("In manpowerService.updateProfile",a),d.triggerLoading(),f={method:"PUT",url:e+"employees/"+a.formDetails.id,headers:{"Content-Type":void 0,"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:JSON.parse(angular.toJson(a.formDetails))},0!==a.file.length&&(f.file=a.file[0],f.fileFormDataName="avatar"),b.upload(f).then(d.successResponse,d.errorResponse)},f.updateSkillSoc=function(b,c,f,g,h,i){return console.log("In manpowerService.updateSkillSoc",b,c,f,g,h),d.triggerLoading(),a({method:"PUT",url:e+"employees/"+b,headers:{"X-USER-ID":i.id,"X-USER-TOKEN":i.authToken},data:{skill_passed:g,passed_date:h,soc_details:c,soc_expired_at:f}}).then(d.successResponse,d.errorResponse)},f.uploadDocument=function(a,c){var f={};return console.log("In manpowerService.uploadDocument",a),d.triggerLoading(),f={method:"POST",url:e+"employees/"+a.id+"/employee_files",headers:{"Content-Type":void 0,"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}},0!==a.file.length&&(f.file=a.file[0],f.fileFormDataName="document"),b.upload(f).then(d.successResponse,d.errorResponse)},f.deleteDocument=function(b,c){return console.log("In manpowerService.deleteDocument"),d.triggerLoading(),a({method:"DELETE",url:e+"employee_files/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},f.archiveProfile=function(b,c){return console.log("In manpowerService.archiveProfile"),d.triggerLoading(),a({method:"POST",url:e+"employees/"+b+"/archive",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},f.unarchiveProfile=function(b,c){return console.log("In manpowerService.unarchiveProfile"),d.triggerLoading(),a({method:"POST",url:e+"employees/"+b+"/unarchive",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},f.deleteProfile=function(b,c){return console.log("In manpowerService.deleteProfile"),d.triggerLoading(),a({method:"DELETE",url:e+"employees/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},f}]),angular.module("oasApp").factory("SettingsService",["$rootScope","$http","AuthService","ApiHandlerService",function(a,b,c,d){var e=d.getUrlPrefix(),f={};return f.settings={},f.getSettings=function(g){return console.log("In settingsService.getSettings"),void 0===g&&c.retrieveSession(),d.triggerLoading(),b({method:"GET",url:e+"settings",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken}}).then(function(b){angular.copy(b.data,f.settings),d.triggerLoaded(),a.$broadcast("settings_updated")})},f.updateSettings=function(a,f){return console.log("In settingsService.updateSettings"),void 0===f&&c.retrieveSession(),d.triggerLoading(),b({method:"POST",url:e+"settings",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:a}).then(d.successResponse,d.errorResponse)},f}]),angular.module("oasApp").controller("PersonalsettingsCtrl",["$scope","$timeout","AccountsService",function(a,b,c){a.position="Employee Position",a.email="Employee@oas.com",a.newPasswordFields={id:a.session.user.id,current_password:void 0,password:void 0,password_confirmation:void 0},a.updatePersonalSettings=function(){var b={};b.formDetails=a.newPasswordFields,b.file=a.selectedImage,c.updateAccount(b,a.session.user).then(function(b){if(console.log("update account done",b),"success"===b.result)return a.files=null,a.newPasswordFields={id:a.session.user.id,current_password:void 0,password:void 0,password_confirmation:void 0},void a.session.restoreSession();switch(b.status){case 422:console.error("422: ",b.data),a.launchErrorModal(b.data);break;case 401:$rootScope.$broadcast("not_authenticated")}})},a.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=FileAPI.html5),a.selectedImage=[],a.avatarThumb=null,a.onImageSelect=function(b){a.selectedImage=b},a.$watch("files",function(b){if(a.formUpload=!1,null!=b)for(var c=0;c<b.length;c++)a.errorMsg=null,function(b){a.generateThumb(b)}(b[c])}),a.generateThumb=function(c){null!=c&&a.fileReaderSupported&&c.type.indexOf("image")>-1&&b(function(){var d=new FileReader;d.readAsDataURL(c),d.onload=function(c){b(function(){a.avatarThumb=c.target.result})}})}}]).directive("settingsPersonal",function(){return{templateUrl:"views/personalsettings.html"}}),angular.module("oasApp").controller("AccountsettingsCtrl",["$rootScope","$scope","$modal","AccountsService",function(a,b,c,d){var e=function(a){a===b.accountParams.page?(console.log("accounts limit reached"),b.enableInfiniteScroll=!1):b.enableInfiniteScroll=!0};b.enableInfiniteScroll=!1,b.editNewAccount=!1,b.accountParams={page:1},b.accountsService=d,b.accountsService.accounts=d.accounts,b.$on("tab_changed",function(){b.enableInfiniteScroll=!1}),b.$on("update_accountsettings",function(c,d){console.log("update_accountsettings triggered",d),d&&(b.enableInfiniteScroll=!1,b.editNewAccount=!1,b.accountParams={page:1},a.$broadcast("clear_newaccount")),b.accountsService.getAccounts(b.accountParams,b.session.user).then(e)}),b.nextPage=function(){b.enableInfiniteScroll&&(console.log("account settings nextPage"),b.accountParams.page+=1,b.accountsService.getAccounts(b.accountParams,b.session.user).then(e))},b.toggleNewAccount=function(){b.editNewAccount=!b.editNewAccount,a.$broadcast("clear_newaccount")},b.deleteAccount=function(d){var e=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"account"}}}});e.result.then(function(c){c&&(console.log("Deleting account : ",d),b.accountsService.deleteAccount(d,b.session.user).then(function(c){if(console.log("delete account done",c),"success"===c.result)return void a.$broadcast("update_accountsettings",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}}))})}}]).directive("settingsAccounts",function(){return{templateUrl:"views/accountsettings.html"}}),angular.module("oasApp").controller("ForgotpasswordCtrl",["$scope","$modalInstance",function(a,b){a.email="",a.ok=function(a){b.close(a)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("oasApp").controller("GeneralsettingsmodalCtrl",["$rootScope","$scope","$modalInstance","SettingsService",function(a,b,c,d){b.settingsService=d,b.settingsService.settings=d.settings,b.settingsService.getSettings(b.session.user),b.save=function(){console.log("Updating settings"),b.settingsService.updateSettings(b.settingsService.settings,b.session.user).then(function(d){if(console.log("update settings done",d),c.close(""),"success"===d.result)return a.$broadcast("settings_changed"),void c.close("");switch(d.status){case 422:console.error("422: ",d.data),b.launchErrorModal(d.data);break;case 401:a.$broadcast("not_authenticated")}})},b.cancel=function(){c.dismiss("cancel")}}]),angular.module("oasApp").controller("DeleteconfirmationCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){a.response=!1,a.deletetype=c.type,a.confirm=function(){b.close(!0)},a.cancel=function(){b.dismiss("cancel")}}]).directive("deleteconfirmation",function(){return{templateUrl:"views/modal/deleteconfirmation.html"}}),angular.module("oasApp").directive("matchwith",function(){return{require:"ngModel",scope:{otherValue:"=matchwith"},link:function(a,b,c,d){d.$validators.matchwith=function(b){return b==a.otherValue.$viewValue},a.$watch(a.otherValue,function(){d.$validate()})}}}),angular.module("oasApp").controller("AccountcardCtrl",["$rootScope","$scope","$timeout","AccountsService",function(a,b,c,d){b.editAccount=!1,b.accountRoleFlags={employee_profile:!1,employee_attendance:!1,salary:!1,allocation:!1,labor_cost:!1,material_cost:!1,project_cost:!1},angular.forEach(b.account.roles,function(a){b.accountRoleFlags[a]=!0}),b.updateAccount=function(){b.account.roles=[];var c=!1;angular.forEach(b.accountRoleFlags,function(a,d){console.log(a,d),a&&(b.account.roles.push(d),c=!0)});var e={};e.formDetails=b.account,e.file=b.selectedImage,d.updateAccount(e,b.session.user).then(function(e){if(console.log("update account done",e),b.editAccount=!1,"success"===e.result){if(!c)return void a.$broadcast("update_accountsettings",!0);d.changeRoles(e.data.id,b.account.roles,b.session.user).then(function(c){if("success"===c.result)return void a.$broadcast("update_accountsettings",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}else switch(e.status){case 422:console.error("422: ",e.data),b.launchErrorModal(e.data);break;case 401:a.$broadcast("not_authenticated")}})},b.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=FileAPI.html5),b.selectedImage=[],b.avatarThumb=null,b.onImageSelect=function(a){b.selectedImage=a},b.$watch("files",function(a){if(b.formUpload=!1,null!=a)for(var c=0;c<a.length;c++)b.errorMsg=null,function(a){b.generateThumb(a)}(a[c])}),b.generateThumb=function(a){null!=a&&b.fileReaderSupported&&a.type.indexOf("image")>-1&&c(function(){var d=new FileReader;d.readAsDataURL(a),d.onload=function(a){c(function(){b.avatarThumb=a.target.result})}})}}]).directive("accountCard",function(){return{templateUrl:"views/accountcard.html"}}),angular.module("oasApp").controller("ProfilecardCtrl",["$rootScope","$scope","$modal","$filter","$timeout",function(a,b,c,d,e){b.foreignOptions=[{id:0,name:"Local"},{id:1,name:"Foreigner"}],b.positionOptions=["Supervisor","Asst Supervisor","Worker"],b.nationalityOptions=[{abbrev:"Bgd",name:"Bangladeshi"},{abbrev:"Chn",name:"Chinese"},{abbrev:"Ind",name:"Indian"},{abbrev:"Mmr",name:"Myanmar"},{abbrev:"Mys",name:"Malaysian"},{abbrev:"Sgp",name:"Singaporean"},{abbrev:"Other",name:"Other"}],b.nationality=function(a){for(var c=0;c<b.nationalityOptions.length;c++)if(b.nationalityOptions[c].abbrev===a)return b.nationalityOptions[c].name},b.editMode=!1,b.employee.date_of_birth=new Date(b.employee.date_of_birth),b.employee.joined_date=new Date(b.employee.joined_date),b.employee.application_date=new Date(b.employee.application_date),b.employee.wp_expired_at=new Date(b.employee.wp_expired_at),b.employee.passport_expired_at=new Date(b.employee.passport_expired_at),b.employee.commence_date=new Date(b.employee.commence_date),b.newSoc={soc:null,soc_expired_at:null},b.newSkill={skill_passed:null,passed_date:null},b.addNewSoc=function(){b.newSoc.soc&&b.newSoc.soc_expired_at&&(b.employee.soc_details.push(b.newSoc.soc),b.employee.soc_expired_at.push(b.newSoc.soc_expired_at),b.newSoc={soc:null,soc_expired_at:null})},b.addNewSkill=function(){b.newSkill.skill_passed&&b.newSkill.passed_date&&(b.employee.skill_passed.push(b.newSkill.skill_passed),b.employee.passed_date.push(b.newSkill.passed_date),b.newSkill={skill_passed:null,passed_date:null})},b.removeSocEntry=function(a){b.employee.soc_details.splice(a,1),b.employee.soc_expired_at.splice(a,1)},b.removeSkillEntry=function(a){b.employee.skill_passed.splice(a,1),b.employee.passed_date.splice(a,1)},b.toggleEdit=function(){b.editMode=!b.editMode},b.saveChanges=function(c){if(!b.profileForm.$valid)return void b.launchErrorModal(["Form invalid.","Please check before submission."]);c.avatar===c.avatar_medium_url&&(c.avatar=null);var d={};d.formDetails=c,d.file=b.selectedImage,b.manpowerService.updateProfile(d,b.session.user).then(function(c){if(console.log("update profile done",c),b.toggleEdit(),"success"===c.result)return b.employee.avatar_medium_url=c.data.avatar_medium_url,void b.manpowerService.updateSkillSoc(b.employee.id,b.employee.soc_details,b.employee.soc_expired_at,b.employee.skill_passed,b.employee.passed_date,b.session.user).then(function(c){if("success"!==c.result)switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}});switch(c.status){case 500:console.error("500: ",c.data),b.launchErrorModal(["Internal server error"]);break;case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=FileAPI.html5),b.selectedImage=[],b.avatarThumb=null,b.onImageSelect=function(a){b.selectedImage=a},b.$watch("files",function(a){if(b.formUpload=!1,null!=a)for(var c=0;c<a.length;c++)b.errorMsg=null,function(a){b.generateThumb(a)}(a[c])}),b.generateThumb=function(a){null!=a&&b.fileReaderSupported&&a.type.indexOf("image")>-1&&e(function(){var c=new FileReader;c.readAsDataURL(a),c.onload=function(a){e(function(){b.avatarThumb=a.target.result})}})},b.onDocumentSelect=function(c,d){var e={};e.id=d,e.file=c,b.manpowerService.uploadDocument(e,b.session.user).then(function(c){if(console.log("upload document done",c),"success"===c.result)return void b.employee.employee_files.push(c.data);switch(c.status){case 500:console.error("500: ",c.data),b.launchErrorModal(["Internal server error"]);break;case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.deleteDocument=function(c){b.manpowerService.deleteDocument(c,b.session.user).then(function(e){if(console.log("document deleted :",c),"success"===e.result){var f=d("filter")(b.employee.employee_files,{id:c}),g=b.employee.employee_files.indexOf(f);return void b.employee.employee_files.splice(g,1)}switch(e.status){case 500:console.error("500: ",e.data),b.launchErrorModal(["Internal server error"]);break;case 422:console.error("422: ",e.data),b.launchErrorModal(e.data);break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("profileCard",function(){return{templateUrl:"views/profilecard.html"}}),angular.module("oasApp").constant("HTTP_PARAMS",{prodApi:"http://api.oaspainting.com/v1/",devApi:"http://54.169.2.173/v1/",appSecret:"992bb2ecb4aca0986c898f19801731d1297220bb857961a0bd2661d5d327c4a2"}),angular.module("oasApp").factory("Session",["$rootScope","$cookies","$cookieStore","$http","$location","$timeout","HTTP_PARAMS",function(a,b,c,d,e,f,g){var h="";h="mobility.oaspainting.com"===e.host()?g.prodApi:g.devApi;var i={};return i.user={},i.create=function(c){var d=1===c.admin,e={id:c.id,name:c.name,email:c.email,avatarMedium:c.avatar_medium_url,avatarThumb:c.avatar_thumb_url,authToken:c.authentication_token,admin:d,roles:{}};d?(e.position="Admin",e.roles={employee_profile:!0,employee_attendance:!0,salary:!0,allocation:!0,labor_cost:!0,material_cost:!0,project_cost:!0}):(e.position=c.position,angular.forEach(c.roles,function(a){e.roles[a]=!0})),b.id=c.id,b.authToken=c.authentication_token,angular.copy(e,i.user);var f={id:e.id,activePanel:"manpower",activeTab:"profiles"};localStorage.lastViewed=angular.toJson(f),a.$broadcast("session_created",c.shown_settings)},i.destroy=function(){angular.copy({},i.user),localStorage.clear(),c.remove("userId"),c.remove("user"),c.remove("authToken")},i.restoreSession=function(){var c=b.id,e=b.authToken,f={};d({method:"GET",url:h+"sessions",headers:{"X-USER-ID":c,"X-USER-TOKEN":e}}).then(function(b){console.log("restore call res : ",b);var c=b.data,d=1===c.admin;f={id:c.id,name:c.name,email:c.email,position:c.position,avatar:c.avatar_original_url,avatarMedium:c.avatar_medium_url,avatarThumb:c.avatar_thumb_url,admin:d,authToken:e,roles:{}},d?(f.position="Admin",f.roles={employee_profile:!0,employee_attendance:!0,salary:!0,allocation:!0,labor_cost:!0,material_cost:!0,project_cost:!0}):angular.forEach(c.roles,function(a){f.roles[a]=!0}),angular.copy(f,i.user);var g=angular.fromJson(localStorage.lastViewed);f.id!==g.id&&(g={id:f.id,activePanel:"manpower",activeTab:"profiles"},localStorage.lastViewed=angular.toJson(g)),a.$broadcast("session_restored")})},i}]),angular.module("oasApp").controller("SalarycarddailyCtrl",["$rootScope","$scope","$q",function(a,b,c){var d={project_allowance:0,extra_money:1,external_work:2,mc:3,hp:4,safety:5,transport_allowance:6,additional:7},e=function(a){console.log("Processing costType : ",a);var c,e={date:b.dailyParams.date,cost_type:d[a]};return b.employee[a]?(c=b.employee[a],e.cost=c.cost,c.id?(console.log("Update cost : ",a,e),b.salaryService.updateDailyCost(e,c.id,b.session.user)):(console.log("Create cost : ",a,e),b.salaryService.createDailyCost(e,b.employee.id,b.session.user))):void 0};b.save=function(a){console.log("SAVING SALARY : ",a),c.all([e("project_allowance"),e("extra_money"),e("external_work"),e("mc"),e("hp"),e("safety"),e("transport_allowance"),e("additional")]).then(function(){b.editMode=!1},function(){b.launchErrorModal(["Error in saving records.","Please try again."])})}}]).directive("salaryCardDaily",function(){return{templateUrl:"views/salarycarddaily.html"}}),angular.module("oasApp").controller("SalarycardmonthlyCtrl",["$rootScope","$scope",function(a,b){b.employee.sixteenDays=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16"],b.employee.records=[];var c=function(a){for(var c,d,e,f=b.employee.dates,g=0;a>g;g++)c=g+1,c=10>c?"0"+c:""+c,b.employee.records[g]={day:c,overtime_hour_count:"-",projects_abbrev_name:"-"};for(var h=0,i=f.length;i>h;h++)e=f[h],d=Number(e.date),b.employee.records[d-1]={day:e.date,overtime_hour_count:e.overtime_hour_count,projects_abbrev_name:e.projects_abbrev_name}};b.selectForPrinting=function(){a.$broadcast("print_add_employee",b.employee)},b.$watch("monthlyParams.month",function(a,d){if(console.log("newDate: ",a,d),""===a)return void(a=d);var e,f;if("object"==typeof a){var g=new Date(a);f=g.getMonth()+1,e=g.getFullYear(),10>f&&(f="0"+f),a=e+"-"+f}e=a.substring(0,4),f=a.substring(5,7);for(var h=new Date(e,f,0).getDate(),i=[],j=0,k=h-16;k>j;j++)i.push(j+17);b.employee.remainingDaysInMonth=i,c(h)})}]).directive("salaryCardMonthly",function(){return{templateUrl:"views/salarycardmonthly.html"}}),angular.module("oasApp").directive("alphabetList",["$rootScope",function(a){return{templateUrl:"views/alphabetlist.html",restrict:"E",scope:{},link:function(b,c,d){b.alphabetArray=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],b.activeChar="",b.changeActiveChar=function(c){c!==b.activeChar&&(b.activeChar=c,a.$broadcast(d.page+"_alphabet_changed",b.activeChar))},b.$on("alphabetlist_reset",function(){b.activeChar=""})}}}]),angular.module("oasApp").filter("nulldash",function(){return function(a){return null==a||void 0===a?"-":a}}),angular.module("oasApp").controller("NewprofileCtrl",["$rootScope","$scope","$modal","$timeout",function(a,b,c,d){var e=function(){b.newEmployee={name:"New Employee",avatar:null,avatar_medium_url:null,login_id:null,passcode:null,dormitory_address:null,nationality:null,foreign:0,date_of_birth:null,position:"Worker",joined_date:null,work_permit_number:null,application_date:null,commence_date:null,employment_period:null,fin:null,wp_expired_at:null,passport:null,passport_expired_at:null,skill_passed:[],passed_date:[],soc_details:[],soc_expired_at:[],additional_qualification:null,others:null,basic_rate:null,skill_rate:null,overtime_rate:null,levy_rate:null,meal_allowance:null,employee_files:null}};e(),b.$watch("newProfile",function(){e()}),b.foreignOptions=[{id:0,name:"Local"},{id:1,name:"Foreigner"}],b.positionOptions=["Supervisor","Asst Supervisor","Worker"],b.nationalityOptions=[{abbrev:"Bgd",name:"Bangladeshi"},{abbrev:"Chn",name:"Chinese"},{abbrev:"Ind",name:"Indian"},{abbrev:"Mmr",name:"Myanmar"},{abbrev:"Mys",name:"Malaysian"},{abbrev:"Sgp",name:"Singaporean"},{abbrev:"Other",name:"Other"}],b.newSoc={soc:null,soc_expired_at:null},b.newSkill={skill_passed:null,passed_date:null},b.addNewSoc=function(){b.newSoc.soc&&b.newSoc.soc_expired_at&&(b.newEmployee.soc_details.push(b.newSoc.soc),b.newEmployee.soc_expired_at.push(b.newSoc.soc_expired_at),b.newSoc={soc:null,soc_expired_at:null})},b.addNewSkill=function(){b.newSkill.skill_passed&&b.newSkill.passed_date&&(b.newEmployee.skill_passed.push(b.newSkill.skill_passed),b.newEmployee.passed_date.push(b.newSkill.passed_date),b.newSkill={skill_passed:null,passed_date:null})},b.removeSocEntry=function(a){b.newEmployee.soc_details.splice(a,1),b.newEmployee.soc_expired_at.splice(a,1)},b.removeSkillEntry=function(a){b.newEmployee.skill_passed.splice(a,1),b.newEmployee.passed_date.splice(a,1)},b.createEmployee=function(){if(!b.profileForm.$valid)return void b.launchErrorModal(["Form invalid. Please check before submission."]);var c={};c.formDetails=b.newEmployee,c.file=b.selectedFile,b.manpowerService.createProfile(c,b.session.user).then(function(c){if(console.log("create profile done",c),"success"===c.result)return void(b.newEmployee.soc_details.length>0||b.newEmployee.skill_passed.length>0?b.manpowerService.updateSkillSoc(c.data.id,b.newEmployee.soc_details,b.newEmployee.soc_expired_at,b.newEmployee.skill_passed,b.newEmployee.passed_date,b.session.user).then(function(c){if("success"===c.result)return e(),void a.$broadcast("update_profiles",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}}):(e(),a.$broadcast("update_profiles",!0)));switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=FileAPI.html5),b.selectedFile=[],b.avatarThumb="",b.onFileSelect=function(a){b.selectedFile=a},b.$watch("files",function(a){if(b.formUpload=!1,null!=a)for(var c=0;c<a.length;c++)b.errorMsg=null,function(a){b.generateThumb(a)}(a[c])}),b.generateThumb=function(a){null!=a&&b.fileReaderSupported&&a.type.indexOf("image")>-1&&d(function(){var c=new FileReader;c.readAsDataURL(a),c.onload=function(a){d(function(){b.avatarThumb=a.target.result})}})}}]).directive("newprofileCard",function(){return{templateUrl:"views/newprofilecard.html"}}),angular.module("oasApp").filter("isforeigner",function(){return function(a){return 1===a?"Foreigner":"Local"}}),angular.module("oasApp").factory("AttendanceService",["$http","$filter","AuthService","ApiHandlerService",function(a,b,c,d){var e=d.getUrlPrefix(),f=function(a){var b=["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],c=Number(a[0]+a[1]),d=b.slice(0,c),e=b.slice(c),f=e.concat(d);return f.concat([a])},g=function(a,b){var c,d,e,f=a.map(function(a){return 2!==a.type_code&&3!==a.type_code&&4!==a.type_code?null===a.check_out_time?void(a.type_code=0):(c=Number(a.check_out_time.slice(11,13)),d=Number(a.check_out_time.slice(14,16)),e=60*(60*c+d)*1e3,b>e&&(e+=864e5),e):void 0});return f.unshift(b),f.sort(function(a,b){return a-b}),f},h=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=0,s="";switch(b.type_code){case 1:for(k=Number(b.check_out_time.slice(11,13)),l=Number(b.check_out_time.slice(14,16)),m=60*(60*k+l)*1e3,h=Number(b.check_in_time.slice(11,13)),i=Number(b.check_in_time.slice(14,16)),j=60*(60*h+i)*1e3,d>j&&(j+=864e5),d>m&&(m+=864e5),n=(m-j)/864e3,r=c.length;r>0;)r--,c[r]<=j&&(o=(j-c[r])/864e3,r=0),1===r&&j>=f&&(s="late ");s+=1===b.incomplete?"attendance-entry red-bar":j>=e?"attendance-entry yellow-bar":"attendance-entry blue-bar";break;case 5:for(k=Number(b.check_out_time.slice(11,13)),l=Number(b.check_out_time.slice(14,16)),m=60*(60*k+l)*1e3,h=Number(b.check_in_time.slice(11,13)),i=Number(b.check_in_time.slice(14,16)),j=60*(60*h+i)*1e3,d>j&&(j+=864e5),d>m&&(m+=864e5),n=(m-j)/864e3,r=c.length;r>0;)r--,c[r]<=j&&(o=(j-c[r])/864e3,r=0),1===r&&j>=f&&(s="late ");s="attendance-entry dark-blue-bar";break;case 2:n=100,o=0,s="attendance-entry green-bar";break;case 3:n=100,o=0,s="attendance-entry green-bar";break;case 4:n=100,o=0,s="attendance-entry purple-bar";break;default:for(h=Number(b.check_in_time.slice(11,13)),i=Number(b.check_in_time.slice(14,16)),j=60*(60*h+i)*1e3,g=864e5-j+c[0],n=g/864e3,r=c.length;r>0;)r--,c[r]<=j&&(o=(j-c[r])/864e3,r=0);s="attendance-entry red-bar"}return p=(j-c[0])/864e3,q="attendance-info left",p>50&&(p-=50,q="attendance-info right"),n+="%",o+="%",p+="%",{entryWidth:n,leftMargin:o,wallMargin:p,infoClasses:q,classes:s}},i=function(a,b){console.log("Begin format attendance : ",a);var c=a.check_in_start_at,e=c.split(":"),i=Number(e[0]),k=Number(e[1]),l=60*(60*i+k)*1e3,m=a.overtime_at,n=m.split(":"),o=Number(n[0]),p=Number(n[1]),q=60*(60*o+p)*1e3,r=a.late_after,s=r.split(":"),t=Number(s[0]),u=Number(s[1]),v=60*(60*t+u)*1e3;if(a.timeline=f(c),a.employees.map(function(a){var b=a.attendances,c=g(b,l);return b.map(function(a,b){return a.styles=h(b,a,c,l,q,v),a}),a.checkoutArr=c,a}),b>1){var w=j.attendances.employees.concat(a.employees);a.employees=w,d.triggerLoaded(),angular.copy(a,j.attendances)}else d.triggerLoaded(),angular.copy(a,j.attendances);console.log("parsedData : ",a)},j={attendances:[]};return j.insertSingleAttendance=function(a,c){console.log("In attendanceService.insertSingleAttendance : ",a,c);var d=j.attendances.check_in_start_at,e=d.split(":"),f=Number(e[0]),i=Number(e[1]),k=60*(60*f+i)*1e3,l=j.attendances.overtime_at,m=l.split(":"),n=Number(m[0]),o=Number(m[1]),p=60*(60*n+o)*1e3,q=j.attendances.late_after,r=q.split(":"),s=Number(r[0]),t=Number(r[1]),u=60*(60*s+t)*1e3,v=b("filter")(j.attendances.employees,{id:a})[0];v.checkoutArr=g(v.attendances,v.checkoutArr[0]),v.attendances.push(c),v.attendances.map(function(a,b){return a.styles=h(b,a,v.checkoutArr,k,p,u),a})},j.refreshSingleAttendance=function(a,c){console.log("In attendanceService.refreshSingleAttendance : ",a,c);var d=j.attendances.check_in_start_at,e=d.split(":"),f=Number(e[0]),i=Number(e[1]),k=60*(60*f+i)*1e3,l=j.attendances.overtime_at,m=l.split(":"),n=Number(m[0]),o=Number(m[1]),p=60*(60*n+o)*1e3,q=j.attendances.late_after,r=q.split(":"),s=Number(r[0]),t=Number(r[1]),u=60*(60*s+t)*1e3,v=b("filter")(j.attendances.employees,{id:a})[0],w=b("filter")(v.attendances,{id:c.id}),x=v.attendances.indexOf(w[0]);v.attendances[x]=c,v.checkoutArr=g(v.attendances,v.checkoutArr[0]),v.attendances.map(function(a,b){return a.styles=h(b,a,v.checkoutArr,k,p,u),a})},j.getAttendances=function(b,f,g){return console.log("In attendanceService.getAttendances",b,f),void 0===g&&c.retrieveSession(),d.triggerLoading(),a({method:"GET",url:e+"attendances/"+b,headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:f}).then(function(a){return console.log("before formatAttendance : ",a),i(a.data,f.page),a.data.num_pages})},j.createAttendance=function(b,f,g){return console.log("In attendanceService.createAttendance"),void 0===g&&c.retrieveSession(),d.triggerLoading(),a({method:"POST",url:e+"employees/"+f+"/attendances",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:b}).then(d.successResponse,d.errorResponse)},j.updateAttendance=function(b,c){return console.log("In attendanceService.updateAttendance"),d.triggerLoading(),a({method:"PUT",url:e+"attendances/"+b.id,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:b}).then(d.successResponse,d.errorResponse)},j.deleteAttendance=function(c,f){return console.log("In attendanceService.deleteAttendance",j.attendances),d.triggerLoading(),a({method:"DELETE",url:e+"attendances/"+c,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken}}).then(function(){var a,e=!1;j.attendances.employees.map(function(d){if(!e){var f=b("filter")(d.attendances,{id:c});a=d.attendances.indexOf(f[0]),console.log("deleting: ",f,c,a),-1!==a&&(d.attendances.splice(a,1),e=!0)}}),d.triggerLoaded()},d.errorResponse)},j.getEmployeeAttendanceSummary=function(b,f,g){return console.log("In attendanceService getEmployeeAttendanceSummary",b,f),void 0===g&&c.retrieveSession(),d.triggerLoading(),a({method:"GET",url:e+"employees/"+b+"/attendances",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:{month:f}}).then(d.successResponse,d.errorResponse)},j.reparseAttendanceData=function(){console.log("In attendanceService.reparseAttendanceData")},j}]),angular.module("oasApp").controller("AttendancecardCtrl",["$rootScope","$scope",function(){}]).directive("attendanceCard",function(){return{templateUrl:"views/attendancecard.html"}}),angular.module("oasApp").controller("AttendanceentryCtrl",["$scope",function(a){a.$watch("selectedEntryId",function(){a.active=a.isEquals(a.selectedEntryId,a.entry.id)?"active":""}),a.$watch("selectedProject",function(b){a.setSelectedEntryId(-1),a.disabled=a.isEquals(b,a.entry.project.name)||"All projects"===b?"":"disabled"})}]).directive("attendanceEntry",function(){return{templateUrl:"views/attendanceentry.html"}}),angular.module("oasApp").controller("CreateentryCtrl",["$scope","$filter","$modalInstance","modalInfo",function(a,b,c,d){var e=["PROJECT","LEAVE","MEDICAL LEAVE","PUBLIC HOLIDAY"];a.ok=function(){var b=e.indexOf(a.selectedEntryType)+1,f=a.selectedProjectId,g=a.selectedProjectName,h=new Date(d.newEntryDate),i={},j=d.startTime,k=j.split(":"),l=Number(k[0]),m=Number(k[1]),n=h.setHours(l,m,0,0);if(a.errorMessage="",""===b||""===f)return void(a.errorMessage="All fields are required.");if(1===b&&(""===o||""===t))return void(a.errorMessage="All fields are required.");if(i.project_id=f,i.projectName=g,i.type_code=b,i.employeeId=d.employeeId,1===b){var h=new Date(d.newEntryDate),o=a.checkinTime,p=o.split(":"),q=Number(p[0]),r=Number(p[1]),s=h.setHours(q,r,0,0),t=a.checkoutTime,u=t.split(":"),v=Number(u[0]),w=Number(u[1]),x=h.setHours(v,w,0,0);n>s&&(s+=864e5),n>x&&(x+=864e5);var y=new Date(s),z=new Date(x);i.check_in_time=y.toISOString(),i.check_out_time=z.toISOString()}(2===b||3===b||4===b)&&(h.setHours(l,m,0,0),i.check_in_time=h.toISOString(),i.remark=a.entryRemarks),console.log("newEntryParams : ",i),c.close(i)},a.cancel=function(){c.dismiss("cancel")},a.isSelectedEntryType=function(b){return e.indexOf(a.selectedEntryType)===b-1},a.chooseEntryType=function(b){a.selectedEntryType=e[b-1]},a.chooseProject=function(c){var d={};a.selectedProjectId=c,d=b("filter")(a.projects,{id:c})[0],a.selectedProjectName=d.name,a.selectedProjectAddress=d.address},a.projects=d.projects,a.selectedEntryType="",a.selectedProjectId="",a.selectedProjectName="",a.selectedProjectAddress="",a.entryRemarks="",a.errorMessage="",a.status={isopen:!1},a.toggleDropdown=function(b){b.preventDefault(),b.stopPropagation(),a.status.isopen=!a.status.isopen
}}]),angular.module("oasApp").factory("ProjectsService",["$http","AuthService","ApiHandlerService",function(a,b,c){var d=c.getUrlPrefix(),e=function(a){return a.office_expense=100*a.office_expense,c.triggerLoaded(),a},f=function(a){var b=a.data.labor_cost,d=[],e=[],f=[],g=[];return b.map(function(a){d.push(a.normal),e.push(a.overtime),f.push(a.date)}),g={labor_cost:{normal:d,overtime:e,dates:f},total_cost:a.data.total_cost},console.log("parseLaborcostData : ",g),c.triggerLoaded(),g},g={};return g.projects=[],g.getProjects=function(e){return console.log("In projectsService.getProjects"),void 0===e&&b.retrieveSession(),c.triggerLoading(),a({method:"GET",url:d+"projects",headers:{"X-USER-ID":e.id,"X-USER-TOKEN":e.authToken}}).then(function(a){c.triggerLoaded(),angular.copy(a.data.projects,g.projects)})},g.getProjectDetails=function(f,g){return console.log("In projectsService.getProjectDetails"),void 0===g&&b.retrieveSession(),c.triggerLoading(),a({method:"GET",url:d+"projects/"+f,headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken}}).then(function(a){return e(a.data)})},g.getLaborCost=function(e,g,h){return console.log("In projectsService.getLaborCost",e,g),void 0===h&&b.retrieveSession(),c.triggerLoading(),a({method:"GET",url:d+"projects/"+g+"/labor_costs",headers:{"X-USER-ID":h.id,"X-USER-TOKEN":h.authToken},params:{month:e}}).then(f,c.errorResponse)},g.createProject=function(e,f){return console.log("In projectsService.createProject",e),void 0===f&&b.retrieveSession(),c.triggerLoading(),a({method:"POST",url:d+"projects/",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:e}).then(c.successResponse,c.errorResponse)},g.updateProject=function(e,f){return console.log("In projectsService.updateProject",e),void 0===f&&b.retrieveSession(),c.triggerLoading(),a({method:"PUT",url:d+"projects/"+e.id,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:e}).then(c.successResponse,c.errorResponse)},g.deleteProject=function(e,f){return console.log("In projectsService.deleteProject : ",e),void 0===f&&b.retrieveSession(),c.triggerLoading(),a({method:"DELETE",url:d+"projects/"+e,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken}}).then(c.successResponse,c.errorResponse)},g}]),angular.module("oasApp").controller("CreateentryconfirmationCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){a.modalInfo=c,a.isEntryType=function(a){return c.type===a},a.confirm=function(){b.close(!0)},a.cancel=function(){b.dismiss("cancel")}}]).directive("createentryconfirmation",function(){return{templateUrl:"views/modal/createentryconfirmation.html"}}),angular.module("oasApp").controller("AttendanceinfoCtrl",["$rootScope","$scope",function(a,b){b.entryIncomplete=1===b.entry.incomplete,b.confirmEntry=function(){console.log("Confirm entry",b.entry),b.entry.incomplete=0;var c={id:b.entry.id,incomplete:0};b.attendanceService.updateAttendance(c,b.session.user).then(function(c){if("success"===c.result)return void b.attendanceService.refreshSingleAttendance(b.employee.id,c.data);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("attendanceInfo",function(){return{templateUrl:"views/attendanceinfo.html"}}),angular.module("oasApp").controller("EditentryCtrl",["$scope","$filter","$modalInstance","modalInfo",function(a,b,c,d){console.log("modalinfo",d);var e=["PROJECT","LEAVE","MEDICAL LEAVE","PUBLIC HOLIDAY"];a.ok=function(){{var b=e.indexOf(a.selectedEntryType)+1,f=a.selectedProjectId,g=new Date(d.entryDate),h={},i=d.startTime,j=i.split(":"),k=Number(j[0]),l=Number(j[1]);g.setHours(k,l,0,0)}if(a.errorMessage="",""===b||""===f)return void(a.errorMessage="All fields are required.");if(1===b&&(""===m||""===r))return void(a.errorMessage="All fields are required.");if(h.project_id=f,h.type_code=b,h.id=d.entry.id,1===b){var g=new Date(d.entryDate),m=a.checkinTime,n=m.split(":"),o=Number(n[0]),p=Number(n[1]),q=g.setHours(o,p,0,0),r=a.checkoutTime,s=r.split(":"),t=Number(s[0]),u=Number(s[1]),v=g.setHours(t,u,0,0);q>v&&(v+=864e5);var w=new Date(q),x=new Date(v);h.check_in_time=w.toISOString(),h.check_out_time=x.toISOString()}(2===b||3===b||4===b)&&(g.setHours(k,l,0,0),h.check_in_time=g.toISOString(),h.remark=a.entryRemarks),console.log("edit entryParams : ",h),c.close(h)},a.cancel=function(){c.dismiss("cancel")},a.isSelectedEntryType=function(b){return e.indexOf(a.selectedEntryType)===b-1},a.chooseEntryType=function(b){a.selectedEntryType=e[b-1]},a.chooseProject=function(c){var d={};a.selectedProjectId=c,d=b("filter")(a.projects,{id:c})[0],a.selectedProjectName=d.name,a.selectedProjectAddress=d.address},a.projects=d.projects,a.selectedEntryType="",a.selectedProjectId="",a.selectedProjectName="",a.selectedProjectAddress="",a.entryRemarks="",a.errorMessage="",a.checkinTime="",a.checkoutTime="",a.chooseProject(d.entry.project.id),a.chooseEntryType(d.entry.type_code),a.checkinTime=b("date")(d.entry.check_in_time,"HH:mm"),a.checkoutTime=b("date")(d.entry.check_out_time,"HH:mm"),a.status={isopen:!1},a.toggleDropdown=function(b){b.preventDefault(),b.stopPropagation(),a.status.isopen=!a.status.isopen}}]),angular.module("oasApp").factory("SalaryService",["$http","AuthService","ApiHandlerService",function(a,b,c){var d=c.getUrlPrefix(),e={},f=function(a,b){if(b.employees.map(function(a){a.selectedForPrinting=!1}),a>1){var d=e.salary.monthly.concat(b.employees);angular.copy(d,e.salary.monthly)}else angular.copy(b.employees,e.salary.monthly);c.triggerLoaded()};return e.salary={daily:[],monthly:[]},e.getDailySalary=function(f,g){return console.log("In salaryService.getDailySalary",f),void 0===g&&b.retrieveSession(),c.triggerLoading(),a({method:"GET",url:d+"daily_salaries/",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:f}).then(function(a){if(f.page>1){var b=e.salary.daily.concat(a.data.employees);angular.copy(b,e.salary.daily)}else angular.copy(a.data.employees,e.salary.daily);return c.triggerLoaded(),a.data.num_pages})},e.createDailyCost=function(e,f,g){return console.log("In salaryService.createDailyCost"),void 0===g&&b.retrieveSession(),c.triggerLoading(),a({method:"POST",url:d+"employees/"+f+"/daily_costs",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:e}).then(c.successResponse,c.errorResponse)},e.updateDailyCost=function(e,f,g){return console.log("In salaryService.updateDailyCost"),void 0===g&&b.retrieveSession(),c.triggerLoading(),a({method:"PUT",url:d+"daily_costs/"+f,headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:e}).then(c.successResponse,c.errorResponse)},e.getMonthlySalary=function(e,g){return console.log("In salaryService.getMonthlySalary",e),void 0===g&&b.retrieveSession(),c.triggerLoading(),a({method:"GET",url:d+"monthly_salaries/",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:e}).then(function(a){return f(e.page,a.data),a.data.num_pages})},e.getAllMonthlySalary=function(e,f){return console.log("In salaryService.getAllMonthlySalary ",e),void 0===f&&b.retrieveSession(),c.triggerLoading(),a({method:"GET",url:d+"monthly_salaries/",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},params:e}).then(function(a){return c.triggerLoaded(),a.data.employees})},e}]),angular.module("oasApp").filter("nullzero",function(){return function(a){return null==a||void 0===a?0:a}}),angular.module("oasApp").controller("ErrormodalCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){a.errors=c.errors,a.isNotification=c.isNotification?c.isNotification:!1,a.cancel=function(){b.dismiss("cancel")}}]).directive("errormodal",function(){return{templateUrl:"views/modal/errormodal.html"}}),angular.module("oasApp").controller("AttendancelocationmodalCtrl",["$scope","$modalInstance","modalInfo","BingMapsService",function(a,b,c,d){var e,f;a.entry=c.entry,a.isCheckIn="checkin"===c.type,a.bingMapsService=d,a.isCheckIn?(e=a.entry.check_in_latitude,f=a.entry.check_in_longitude):(e=a.entry.check_out_latitude,f=a.entry.check_out_longitude),a.mapImage=a.bingMapsService.getMap(e,f),a.cancel=function(){b.dismiss("cancel")}}]),angular.module("oasApp").controller("CreateprojectCtrl",["$scope","$modalInstance",function(a,b){a.projectParams={name:"",abbrev_name:"",developer_name:"",main_contractor:"",contractor_sum:"",start_date:"",top_date:"",address:""},a.ok=function(){console.log("in ok : ",a.projectParams),b.close(a.projectParams)},a.cancel=function(){a.projectParams={name:"",abbrev_name:"",developer_name:"",main_contractor:"",contractor_sum:"",start_date:"",top_date:"",address:""},b.dismiss("cancel")}}]);var CURRENCY_REGEXP=/^\d+(\.\d{1,2})?$/;angular.module("oasApp").directive("currency",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.currency=function(a,b){return d.$isEmpty(b)?!0:CURRENCY_REGEXP.test(b)?!0:!1}}}}).directive("supervisorRequired",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.supervisorRequired=function(a,b){console.log("checking supervisor-required",c.position);var e=c.position;return"Worker"===e?!0:d.$isEmpty(b)?!1:!0}}}}).directive("earlierThan",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.earlierThan=function(a,b){if(d.$isEmpty(b))return!0;if(!c.datelimit)return!0;var e=c.datelimit,f=Date.parse(b);return"today"===e?(e=new Date,e=Date.parse(e)):e=Date.parse(e.substring(1,20)),f>e?!1:!0}}}}).directive("laterThan",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.laterThan=function(a,b){if(d.$isEmpty(b))return!0;if(!c.datefloor)return!0;var e=c.datefloor,f=Date.parse(b);return"today"===e?(e=new Date,e=Date.parse(e)):e=Date.parse(e.substring(1,20)),e>f?!1:!0}}}}),angular.module("oasApp").factory("BingMapsService",["$http",function(){var a="http://dev.virtualearth.net/REST/v1/Imagery/Map/Road?",b="AkpMfMQZehVe_Q6Huq9R_mW3NV-17qlBZturl2ysWAgxZKclRFiUZGm1fgy9FJNl",c=15,d="600,300",e={};return e.getMap=function(e,f){return a+"key="+b+"&centerPoint="+e+","+f+"&pp="+e+","+f+";65&mapSize="+d+"&zoomLevel="+c},e}]),angular.module("oasApp").factory("AllocationService",["$http","AuthService","ApiHandlerService",function(a,b,c){var d=c.getUrlPrefix(),e={},f=function(a,b,d){var e=b.nationalities,f=b.projects,g=b.allocations,h=[],i=[],j={},k={},l=0,m=0;f.map(function(a){a.total=[],e.map(function(b){a[b]=[]}),j[a.id]=a}),g.map(function(a){h.push(a.date.substr(8))}),g.map(function(a){var b=a.projects;b.map(function(a){m=0,e.map(function(b){l=a.nationalities[b]?a.nationalities[b]:0,m+=l,j[a.id][b].push(l)}),j[a.id].total.push(m)})}),angular.forEach(j,function(a){i.push(a)}),a>1?(k.nationalities=$.extend(d.nationalities,e),k.nationalitiesCount=k.nationalities.length,k.dates=h,k.data=d.data.concat(i)):(k.nationalities=e,k.nationalitiesCount=e.length,k.dates=h,k.data=i),console.log("Allocation finalOutput : ",k),angular.copy(k,d),c.triggerLoaded()};return e.normal={},e.overtime={},e.getNormalAllocations=function(g,h){return console.log("In allocationService.getNormalAllocations",g),void 0===h&&b.retrieveSession(),c.triggerLoading(),a({method:"GET",url:d+"allocations",headers:{"X-USER-ID":h.id,"X-USER-TOKEN":h.authToken},params:g}).then(function(a){return console.log("before formatAllocation : ",g.page,a.data),f(g.page,a.data,e.normal),a.data.num_pages})},e.getOvertimeAllocations=function(g,h){return console.log("In allocationService.getOvertimeAllocations",g),void 0===h&&b.retrieveSession(),c.triggerLoading(),a({method:"GET",url:d+"allocations",headers:{"X-USER-ID":h.id,"X-USER-TOKEN":h.authToken},params:g}).then(function(a){return f(g.page,a.data,e.overtime),a.data.num_pages})},e}]),angular.module("oasApp").directive("dateInput",["dateFilter",function(a){return{require:"ngModel",template:'<input type="date"></input>',replace:!0,link:function(b,c,d,e){e.$formatters.unshift(function(b){return a(b,"yyyy-MM-dd")}),e.$parsers.unshift(function(a){return new Date(a)})}}}]),angular.module("oasApp").controller("LaborcostCtrl",["$scope","ProjectsService",function(a,b){var c=!1;a.projectsService=b,a.laborcostDate=a.today,a.chartData={normal:{dates:[],costs:[]},overtime:{dates:[],costs:[]},total_cost:0},a.totalCost=null,a.chartParams=null,a.chartConfig={options:{credits:{enabled:!1},chart:{type:"area",backgroundColor:"rgba(0,0,0,0)"},legend:{enabled:!1},xAxis:{labels:{formatter:function(){return this.value[8]+this.value[9]}},title:{enabled:!1}},yAxis:{title:{enabled:!1},labels:{format:"${value}"},gridLineWidth:2},plotOptions:{area:{stacking:"normal",lineColor:"#666666",lineWidth:0,marker:{symbol:"circle"},states:{hover:{lineWidthPlus:0}}}},tooltip:{shared:!0,valuePrefix:"$",crosshairs:[{width:15,color:"rgba(153,153,153,0.5)",zIndex:22}],headerFormat:"",pointFormat:'<div class="top-gap text-center bold laborcost-tooltip-title">{series.name}</div><div class="top-gap text-center laborcost-tooltip-value" style="color: {series.color};">{point.y}</div>',backgroundColor:"#000",borderColor:"#000",borderRadius:15,useHTML:!0,valueDecimals:2,style:{padding:"10px 25px"}}},series:[{name:"OT WORKING HOURS COST",data:[],fillColor:"#fbd133",color:"#bf9c24"},{name:"NORMAL WORKING HOURS COST",data:[],fillColor:"#1e8fc1",color:"#2d7ea6"}],title:{text:""},loading:!1},a.$watch("laborcostDate",function(b,d){if(c){if(console.log("laborcost month changed : ",b,d),""===b)return void(b=d);if("object"==typeof b){var e=new Date(b),f=e.getDate(),g=e.getMonth()+1,h=e.getFullYear();10>g&&(g="0"+g),10>f&&(f="0"+f),b=h+"-"+g+"-"+f}a.projectsService.getLaborCost(a.laborcostDate,a.selectedProject.id,a.session.user).then(function(b){a.chartData=b.labor_cost,a.totalCost=b.total_cost,a.chartConfig.series[0].data=b.labor_cost.overtime,a.chartConfig.series[1].data=b.labor_cost.normal,a.chartConfig.options.xAxis.categories=b.labor_cost.dates,console.log("update_laborcost success. response : ",b)},function(a){console.log("Error in update_laborcost : ",a)})}}),a.$on("update_laborcost",function(){a.projectsService.getLaborCost(a.laborcostDate,a.selectedProject.id,a.session.user).then(function(b){a.chartData=b.labor_cost,a.totalCost=b.total_cost,a.chartConfig.series[0].data=b.labor_cost.overtime,a.chartConfig.series[1].data=b.labor_cost.normal,a.chartConfig.options.xAxis.categories=b.labor_cost.dates,c=!0,console.log("update_laborcost success. response : ",b)},function(a){console.log("Error in update_laborcost : ",a)})}),a.datepickers={laborcostDate:!1},a.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},a.open=function(b){b.preventDefault(),b.stopPropagation();var c={laborcostDate:!1};angular.copy(c,a.datepickers),a.datepickers[b.target.name]=!0},a.shiftMonth=function(b){var c,d,e,f=typeof a.laborcostDate,g=a.laborcostDate,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setMonth(h.getMonth()+b),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),a.laborcostDate=e+"-"+d+"-"+c}}]).directive("projectLaborcost",function(){return{templateUrl:"views/laborcost.html"}}),angular.module("oasApp").controller("MaterialscostCtrl",["$rootScope","$scope","$modal","ProjectsService","MaterialsService",function(a,b,c,d,e){var f=function(a){a===b.materialsParams.page?(console.log("materials profiles limit reached"),b.enableInfiniteScroll.materials=!1):b.enableInfiniteScroll.materials=!0},g=function(a){a===b.accessoriesParams.page?(console.log("accessories profiles limit reached"),b.enableInfiniteScroll.accessories=!1):b.enableInfiniteScroll.accessories=!0};b.firstLoad=!0,b.editMaterials=!1,b.editAccessories=!1,b.enableInfiniteScroll={materials:!1,accessories:!1},b.materialsParams={name:void 0,page:1},b.accessoriesParams={name:void 0,page:1},b.materialsListParams={name:void 0,page:1},b.accessoriesListParams={name:void 0,page:1},b.materialName="",b.accessoryName="",b.showAutocomplete=!1,b.selectedMaterial={id:void 0,name:void 0,price:void 0,color:void 0,remark:void 0,supplier:void 0},b.selectedAccessory={id:void 0,name:void 0,price:void 0},b.newMaterialCost={material_id:null,price:null,quantity:null,purchase_date:null,purchase_order:null,delivery_date:null,delivery_order:null,invoice_date:null,invoice_number:null,remark:null},b.newAccessoryCost={date:null,accessory_id:null,price:null,"package":null,quantity:null,taken:null,remark:null},b.materialsService=e,b.materialsService.costs=e.costs,b.viewtype="materials",b.$on("tab_changed",function(){}),b.$on("update_materialscost",function(a,c){console.log("update_materialcosts triggered",c),(c||b.firstLoad)&&(b.firstLoad=!1,b.enableInfiniteScroll={materials:!1,accessories:!1},b.materialsQuery="",b.materialsParams={name:void 0,page:1},b.accessoriesParams={name:void 0,page:1},b.materialName="",b.accessoryName="",b.showAutocomplete=!1,b.selectedMaterial={id:void 0,name:void 0,price:void 0,color:void 0,remark:void 0,supplier:void 0},b.selectedAccessory={id:void 0,name:void 0,price:void 0},b.newMaterialCost={material_id:null,price:0,quantity:0,total:0,purchase_date:null,purchase_order:null,delivery_date:null,delivery_order:null,invoice_date:null,invoice_number:null,remark:null},b.newAccessoryCost={date:null,accessory_id:null,price:null,"package":null,quantity:null,taken:null,remark:null},b.materialsService.getMaterialCosts(b.materialsParams,b.selectedProject.id,b.session.user).then(f),b.materialsService.getAccessoriesCosts(b.accessoriesParams,b.selectedProject.id,b.session.user).then(g))}),b.$watch("newMaterialCost.quantity",function(){console.log("material quantity changed"),b.newMaterialCost.total=b.selectedMaterial.price*b.newMaterialCost.quantity}),b.$watch("newAccessoryCost.quantity",function(){console.log("accessory quantity changed"),b.newAccessoryCost.total=b.selectedAccessory.price*b.newAccessoryCost.quantity}),b.searchKeypressed=function(a){13===a.charCode&&b.queryMaterialCost(b.viewtype,b.materialsQuery)},b.nextPage=function(){switch(b.viewtype){case"materials":if(!b.enableInfiniteScroll.materials)return;b.materialsParams.page+=1,b.materialsService.getMaterialCosts(b.materialsParams,b.selectedProject.id,b.session.user).then(f);break;case"accessories":if(!b.enableInfiniteScroll.accessories)return;b.accessoriesParams.page+=1,b.materialsService.getAccessoriesCosts(b.accessoriesParams,b.selectedProject.id,b.session.user).then(g)}},b.queryMaterialCost=function(a,c){switch(console.log("querying material cost : ",a,c),b.enableInfiniteScroll={current:!1,archive:!1},b.viewtype){case"materials":b.materialsParams.name=c,b.materialsParams.page=1,b.materialsService.getMaterialCosts(b.materialsParams,b.selectedProject.id,b.session.user).then(f);break;case"accessories":b.accessoriesParams.name=c,b.accessoriesParams.page=1,b.materialsService.getAccessoriesCosts(b.accessoriesParams,b.selectedProject.id,b.session.user).then(g)}},b.createMaterialCost=function(c){console.log("createMaterialCost : ",c),c.id=b.selectedProject.id,c.price=b.selectedMaterial.price,c.material_id=b.selectedMaterial.id,b.materialsService.createMaterialCost(c,b.session.user).then(function(c){if(console.log("create material cost done",c),"success"===c.result)return void a.$broadcast("update_materialscost",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.updateMaterialCost=function(c){console.log("updateMaterialCost : ",c),b.materialsService.updateMaterialCost(c,b.session.user).then(function(c){if(console.log("update material cost done",c),"success"===c.result)return void a.$broadcast("update_materialscost");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.deleteMaterialCost=function(d){var e=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"entry"}}}});e.result.then(function(c){c&&(console.log("delete material cost triggered : ",d),b.materialsService.deleteMaterialCost(d,b.session.user).then(function(c){if(console.log("delete material cost done",c),"success"===c.result)return void a.$broadcast("update_materialscost",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}}))})},b.predictInput=function(a){if(console.log("predicting input for : ",a),""===a)return void(b.showAutocomplete=!1);switch(b.viewtype){case"materials":b.materialsListParams.name=a,b.materialsService.getMaterialsList(b.materialsListParams,b.session.user,!0).then(function(){b.showAutocomplete=!0});break;case"accessories":b.accessoriesListParams.name=a,b.materialsService.getAccessoriesList(b.accessoriesListParams,b.session.user,!0).then(function(){b.showAutocomplete=!0})}},b.selectMaterial=function(a){console.log("select material : ",a),b.selectedMaterial=a,b.materialName=a.name,b.showAutocomplete=!1},b.selectAccessory=function(a){console.log("select accessory : ",a),b.selectedAccessory=a,b.accessoryName=a.name,b.showAutocomplete=!1},b.clearNewMaterial=function(){b.materialName="",b.showAutocomplete=!1,b.selectedMaterial={id:void 0,name:void 0,color:void 0,remark:void 0,supplier:void 0},b.newMaterialCost={material_id:null,price:0,quantity:0,total:0,purchase_date:null,purchase_order:null,delivery_date:null,delivery_order:null,invoice_date:null,invoice_number:null,remark:null}},b.createAccessoryCost=function(c){console.log("createAccessoryCost : ",c),c.id=b.selectedProject.id,c.accessory_id=b.selectedAccessory.id,c.price=b.selectedAccessory.price,b.materialsService.createAccessoryCost(c,b.session.user).then(function(c){if(console.log("create accessory cost done",c),"success"===c.result)return void a.$broadcast("update_materialscost",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.updateAccessoryCost=function(c){console.log("updateAccessoryCost : ",c),b.materialsService.updateAccessoryCost(c,b.session.user).then(function(c){if(console.log("update accessory cost done",c),"success"===c.result)return void a.$broadcast("update_materialscost");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.deleteAccessoryCost=function(d){var e=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"entry"}}}});e.result.then(function(c){c&&(console.log("delete accessory cost triggered : ",d),b.materialsService.deleteAccessoryCost(d,b.session.user).then(function(c){if(console.log("delete accessory cost done",c),"success"===c.result)return void a.$broadcast("update_materialscost",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}}))})},b.clearNewAccessory=function(){b.newAccessoryCost={date:null,accessory_id:null,price:null,"package":null,quantity:null,taken:null,remark:null}},b.showSummary=function(d){switch(d){case"materials":b.materialsService.getMaterialCostSummary(b.selectedProject.id,b.session.user).then(function(d){if(console.log("get materials cost summary done",d),"success"!==d.result)switch(d.status){case 422:console.error("422: ",d.data),b.launchErrorModal(d.data);break;case 401:a.$broadcast("not_authenticated")}else{c.open({templateUrl:"views/modal/materialcostsummarymodal.html",controller:"MaterialcostsummarymodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"lg",windowClass:"modal-oas vertical-center costsummary-modal materialcostsummary-modal",resolve:{modalInfo:function(){return{projectName:b.selectedProject.name,data:d.data}}}})}});break;case"accessories":b.materialsService.getAccessoryCostSummary(b.selectedProject.id,b.session.user).then(function(d){if(console.log("get accessory cost summary done",d),"success"!==d.result)switch(d.status){case 422:console.error("422: ",d.data),b.launchErrorModal(d.data);break;case 401:a.$broadcast("not_authenticated")}else{c.open({templateUrl:"views/modal/accessorycostsummarymodal.html",controller:"AccessorycostsummarymodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"lg",windowClass:"modal-oas vertical-center costsummary-modal accessorycostsummary-modal",resolve:{modalInfo:function(){return{projectName:b.selectedProject.name,data:d.data}}}})}})}}}]).directive("projectMaterialscost",function(){return{templateUrl:"views/materialscost.html"}}),angular.module("oasApp").controller("ProjectscostCtrl",["$rootScope","$scope","$q","$modal","CostsummaryService","PrinterService",function(a,b,c,d,e,f){b.editSummary=!1,b.costsummaryService=e,b.costsummaryService.transactions=e.transactions,b.$on("update_costsummary",function(c,d){console.log("update_costsummary triggered ",d),d&&(a.$broadcast("reset"),b.editSummary=!1,b.dirtyTransactions=[],b.dirtyOfficeExpense=null),b.newTransactionParams={claim:{transaction_type:0,name:"",amount:""},receive:{transaction_type:1,name:"",amount:""},materialExpense:{transaction_type:2,name:"",amount:""},laborCost:{transaction_type:3,name:"",amount:""},others:{transaction_type:9,name:"",amount:""}},b.costsummaryService.getSummary(b.selectedProject.id,b.session.user)}),b.newTransactionParams={claim:{transaction_type:0,name:"",amount:""},receive:{transaction_type:1,name:"",amount:""},materialExpense:{transaction_type:2,name:"",amount:""},laborCost:{transaction_type:3,name:"",amount:""},others:{transaction_type:9,name:"",amount:""}},b.dirtyTransactions=[],b.dirtyOfficeExpense=null,b.newTransaction=function(c){console.log("In newTransaction : ",c);var d={};switch(c){case 0:d=b.newTransactionParams.claim;break;case 1:d=b.newTransactionParams.receive;break;case 2:d=b.newTransactionParams.materialExpense;break;case 3:d=b.newTransactionParams.laborCost;break;case 9:d=b.newTransactionParams.others;break;default:d=b.newTransactionParams.others}b.costsummaryService.createSummaryEntry(d,b.selectedProject.id,b.session.user).then(function(c){if(console.log("add transaction done",c),"success"===c.result)return void a.$broadcast("update_costsummary");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.recordDirtyOfficeExpense=function(a){console.log("in recordDirtyOfficeExpense : ",a),b.dirtyOfficeExpense={id:b.selectedProject.id,office_expense:a/100}},b.recordDirtyTransaction=function(a,c,d){console.log("in recordDirtyTransaction : ",a,c,d);var e=!1;if(b.dirtyTransactions.map(function(b){b.id===a&&(b.name=c,b.amount=d,e=!0)}),!e){var f={id:a,name:c,amount:d};b.dirtyTransactions.push(f)}},b.saveTransactionUpdates=function(){console.log("In saveTransactionUpdates");var d=[];return null!==b.dirtyOfficeExpense&&(console.log("Updating office expense"),b.projectsService.updateProject(b.dirtyOfficeExpense,b.session.user)),0===b.dirtyTransactions.length?void(b.editSummary=!1):(angular.forEach(b.dirtyTransactions,function(a,c){console.log("forEach : ",a,c),d.push(b.costsummaryService.updateSummaryEntry(a,b.session.user))}),void c.all(d).then(function(){b.editSummary=!1,a.$broadcast("update_costsummary",!0)},function(){b.editSummary=!1,b.launchErrorModal(["Error in saving records.","Please try again."]),a.$broadcast("update_costsummary",!0)}))},b.deleteSummaryEntry=function(c){var e=d.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"transaction"}}}});e.result.then(function(d){d&&(console.log("Deleting transaction : ",c),b.costsummaryService.deleteSummaryEntry(c,b.session.user).then(function(c){if(console.log("delete transaction done",c),"success"===c.result)return void a.$broadcast("update_costsummary",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}}))})},b.printSummary=function(){var a={};a.selectedProject=b.selectedProject,a.transactions=b.costsummaryService.transactions,f.print("views/costsummaryprinttemplate.html",a)}}]).directive("projectProjectscost",function(){return{templateUrl:"views/projectscost.html"}}),angular.module("oasApp").factory("PrinterService",["$rootScope","$compile","$http","$timeout","$q",function(a,b,c,d,e){var f=function(a){var b=e.defer(),c=$('<iframe style="display: none"></iframe>').appendTo("body")[0];c.contentWindow.printAndRemove=function(){setTimeout(function(){c.contentWindow.print(),$(c).remove()},6e3)};var d='<!doctype html><html><head><link rel="stylesheet" href="styles/main.css"><link rel="stylesheet" href="styles/modules.css"></head><body style="background-color: #FFF;" onload="printAndRemove();">'+a+"</body></html>",f=c.contentWindow.document.open("text/html","replace");return f.write(d),b.resolve(),f.close(),b.promise},g=function(e,g){console.log("In print : ",e,g),c.get(e).success(function(e){var h=a.$new();angular.extend(h,g);var i=b($("<div>"+e+"</div>"))(h),j=function(){d(h.$$phase||c.pendingRequests.length?j:function(){f(i.html()),h.$destroy()})};j()})},h=function(e,g){a.isBeingPrinted=!0,c.get(e).success(function(e){var h=g,i=b($("<div>"+e+"</div>"))(h),j=function(){h.$$phase||c.pendingRequests.length?d(j):f(i.html()).then(function(){a.isBeingPrinted=!1})};j()})};return{print:g,printFromScope:h}}]),angular.module("oasApp").controller("MaterialsettingsCtrl",["$rootScope","$scope","$modal","$filter","MaterialsService",function(a,b,c,d,e){var f=function(a){a===b.materialParams.page?(console.log("materials limit reached"),b.enableInfiniteScroll=!1):b.enableInfiniteScroll=!0};b.firstLoad=!0,b.enableInfiniteScroll=!1,b.editMaterialSettings=!1,b.materialParams={name:void 0,page:1},b.newMaterial={name:void 0,color:void 0,supplier:void 0,price:void 0,remark:void 0},b.materialsService=e,b.materialsService.materials=e.materials,b.$on("tab_changed",function(){}),b.$on("update_materialsettings",function(a,c){console.log("update_materials triggered",c),(c||b.firstLoad)&&(b.firstLoad=!1,b.enableInfiniteScroll=!1,b.materialParams={name:void 0,page:1},b.newMaterial={name:void 0,color:void 0,supplier:void 0,price:void 0,remark:void 0},b.materialsService.getMaterialsList(b.materialParams,b.session.user).then(f))}),b.$on("materials_search",function(a,c){console.log("materials search triggered : ",c),b.enableInfiniteScroll=!1,b.materialParams.name=c,b.materialParams.page=1,b.materialsService.getMaterialsList(b.materialParams,b.session.user).then(f)}),b.nextPage=function(){b.enableInfiniteScroll&&(console.log("material settings nextPage"),b.materialParams.page+=1,b.materialsService.getMaterialsList(b.materialParams,b.session.user).then(f))},b.editMode=!1,b.addMaterial=function(){console.log("Adding new material : ",b.newMaterial),b.materialsService.addMaterial(b.newMaterial,b.session.user).then(function(c){if(console.log("add material done",c),"success"===c.result)return void a.$broadcast("update_materialsettings",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.updateMaterial=function(c){console.log("updateMaterial : ",c),b.materialsService.updateMaterial(c,b.session.user).then(function(c){if(console.log("updateMaterial done",c),"success"!==c.result)switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.deleteMaterial=function(e){var f=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"material"}
}}});f.result.then(function(c){c&&(console.log("Deleting material : ",e),b.materialsService.deleteMaterial(e,b.session.user).then(function(c){if("success"===c.result){console.log("delete material done",c);var f,g;return f=d("filter")(b.materialsService.materials,{id:e}),g=b.materialsService.materials.indexOf(f[0]),void b.materialsService.materials.splice(g,1)}switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}}))})}}]).directive("settingsMaterials",function(){return{templateUrl:"views/materialsettings.html"}}),angular.module("oasApp").factory("MaterialsService",["$http","$upload","AuthService","ApiHandlerService",function(a,b,c,d){var e=d.getUrlPrefix(),f=function(a,b){console.log("formatMaterialCosts : ",b);if(b.material_costs.map(function(a){a.purchase_date&&(a.purchase_date=new Date(a.purchase_date)),a.delivery_date&&(a.delivery_date=new Date(a.delivery_date)),a.invoice_date&&(a.invoice_date=new Date(a.invoice_date))}),a>1){var c=h.costs.materials.material_costs.concat(b.material_costs);b.material_costs=c,angular.copy(b,h.costs.materials)}else angular.copy(b,h.costs.materials)},g=function(a,b){console.log("formatAccessoryCosts : ",b);if(b.accessory_costs.map(function(a){a.date&&(a.date=new Date(a.date))}),a>1){var c=h.costs.accessories.accessory_costs.concat(b.accessory_costs);b.accessory_costs=c,angular.copy(b,h.costs.accessories)}else angular.copy(b,h.costs.accessories)},h={};return h.materials=[],h.accessories=[],h.costs={},h.costs.materials={},h.costs.accessories={},h.getMaterialsList=function(b,f,g){return console.log("In materialsService.getMaterialsList",b),void 0===f&&c.retrieveSession(),g||d.triggerLoading(),a({method:"GET",url:e+"materials/",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},params:b}).then(function(a){if(console.log("getMaterialsList response : ",a),b.page>1){var c=h.materials.concat(a.data.materials);angular.copy(c,h.materials)}else angular.copy(a.data.materials,h.materials);return g||d.triggerLoaded(),a.data.num_pages})},h.addMaterial=function(b,c){return console.log("In materialsService.addMaterial",b),d.triggerLoading(),a({method:"POST",url:e+"materials/",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:b}).then(d.successResponse,d.errorResponse)},h.updateMaterial=function(b,c){return console.log("In materialsService.updateMaterial",b),d.triggerLoading(),a({method:"PUT",url:e+"materials/"+b.id,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:b}).then(d.successResponse,d.errorResponse)},h.deleteMaterial=function(b,c){return console.log("In materialsService.deleteMaterial",b),d.triggerLoading(),a({method:"DELETE",url:e+"materials/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},h.addAccessory=function(b,c){return console.log("In materialsService.addAccessory",b),d.triggerLoading(),a({method:"POST",url:e+"accessories/",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:b}).then(d.successResponse,d.errorResponse)},h.updateAccessory=function(b,c){return console.log("In materialsService.updateAccessory",b),d.triggerLoading(),a({method:"PUT",url:e+"accessories/"+b.id,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:b}).then(d.successResponse,d.errorResponse)},h.deleteAccessory=function(b,c){return console.log("In materialsService.deleteAccessory",b),d.triggerLoading(),a({method:"DELETE",url:e+"accessories/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},h.getAccessoriesList=function(b,f,g){return console.log("In materialsService.getAccessoriesList",b),void 0===f&&c.retrieveSession(),g||d.triggerLoading(),a({method:"GET",url:e+"accessories/",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},params:b}).then(function(a){if(console.log("getAccessoriesList response : ",a),b.page>1){var c=h.accessories.concat(a.data.accessories);angular.copy(c,h.accessories)}else angular.copy(a.data.accessories,h.accessories);return g||d.triggerLoaded(),a.data.num_pages})},h.getMaterialCosts=function(b,d,g){return console.log("In materialsService.getMaterialCosts",b),void 0===g&&c.retrieveSession(),a({method:"GET",url:e+"projects/"+d+"/material_costs",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:b}).then(function(a){return f(b.page,a.data),a.data.num_pages})},h.createMaterialCost=function(b,f){return console.log("In materialsService.createMaterialCost"),void 0===f&&c.retrieveSession(),d.triggerLoading(),a({method:"POST",url:e+"projects/"+b.id+"/material_costs",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:b}).then(d.successResponse,d.errorResponse)},h.updateMaterialCost=function(b,f){return console.log("In materialsService.updateMaterialCost",b),void 0===f&&c.retrieveSession(),d.triggerLoading(),a({method:"PUT",url:e+"material_costs/"+b.id,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:b}).then(d.successResponse,d.errorResponse)},h.deleteMaterialCost=function(b,c){return console.log("In materialsService.deleteMaterialCost"),d.triggerLoading(),a({method:"DELETE",url:e+"material_costs/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},h.getAccessoriesCosts=function(b,d,f){return console.log("In materialsService.getAccessoriesCosts",b),void 0===f&&c.retrieveSession(),a({method:"GET",url:e+"projects/"+d+"/accessory_costs",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},params:b}).then(function(a){return g(b.page,a.data),a.data.num_pages})},h.createAccessoryCost=function(b,f){return console.log("In materialsService.createAccessoryCost"),void 0===f&&c.retrieveSession(),d.triggerLoading(),a({method:"POST",url:e+"projects/"+b.id+"/accessory_costs",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:b}).then(d.successResponse,d.errorResponse)},h.updateAccessoryCost=function(b,c){return console.log("In materialsService.updateAccessoryCost",b),d.triggerLoading(),a({method:"PUT",url:e+"accessory_costs/"+b.id,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},params:b}).then(d.successResponse,d.errorResponse)},h.deleteAccessoryCost=function(b,c){return console.log("In materialsService.deleteAccessoryCost"),d.triggerLoading(),a({method:"DELETE",url:e+"accessory_costs/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},h.getMaterialCostSummary=function(b,c){return console.log("In materialsService.getMaterialCostSummary"),d.triggerLoading(),a({method:"GET",url:e+"projects/"+b+"/summary_material_costs",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},h.getAccessoryCostSummary=function(b,c){return console.log("In materialsService.getAccessoryCostSummary"),d.triggerLoading(),a({method:"GET",url:e+"projects/"+b+"/summary_accessory_costs",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},h}]),angular.module("oasApp").controller("MaterialcostitemCtrl",["$rootScope","$scope",function(a,b){b.updateMaterialCost=function(c){console.log("updateMaterialCost : ",c),b.materialsService.updateMaterialCost(c,b.session.user).then(function(c){if(console.log("update material cost done",c),"success"===c.result)return void a.$broadcast("update_materialscost");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("materialcostitem",function(){return{templateUrl:"views/materialcostitem.html"}}),angular.module("oasApp").controller("AccessorycostitemCtrl",["$rootScope","$scope",function(a,b){b.updateAccessoryCost=function(c){console.log("updateAccessoryCost : ",c),b.materialsService.updateAccessoryCost(c,b.session.user).then(function(c){if(console.log("update accessory cost done",c),"success"===c.result)return void a.$broadcast("update_materialscost");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("accessorycostitem",function(){return{templateUrl:"views/accessorycostitem.html"}}),angular.module("oasApp").factory("CostsummaryService",["$http","AuthService","ApiHandlerService",function(a,b,c){var d=c.getUrlPrefix(),e=function(a){var b=0,d=0,e=a.material_expense,g=a.labor_cost,h=0,i=0,j=0,k=0,l=0;a.amount_claimed.map(function(a){b+=Number(a.amount)}),a.amount_received.map(function(a){d+=Number(a.amount)}),a.other_material_expenses.map(function(a){e+=a.amount}),a.other_labor_costs.map(function(a){g+=a.amount}),a.others.map(function(a){h+=a.amount}),j=b-d,i=e+g+h,k=d-i,a.total_claimed=b,a.total_received=d,a.total_material_expense=e,a.total_labor_cost=g,a.total_others_expense=h,a.balance_claimed_received=j,a.total_expenses=i,a.project_gain_loss=k,a.balance_gain_loss=l,angular.copy(a,f.transactions),c.triggerLoaded()},f={};return f.transactions={},f.getSummary=function(f,g){return console.log("In costsummaryService.getSummary : ",f),void 0===g&&b.retrieveSession(),c.triggerLoading(),a({method:"GET",url:d+"projects/"+f+"/transactions",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:f}).then(function(a){console.log("getSummary response : ",a),e(a.data)})},f.createSummaryEntry=function(b,e,f){return console.log("In costsummaryService.createSummaryEntry : ",b),c.triggerLoading(),a({method:"POST",url:d+"projects/"+e+"/transactions",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:b}).then(c.successResponse,c.errorResponse)},f.updateSummaryEntry=function(b,e){return console.log("In costsummaryService.updateSummaryEntry : ",b),c.triggerLoading(),a({method:"PUT",url:d+"transactions/"+b.id,headers:{"X-USER-ID":e.id,"X-USER-TOKEN":e.authToken},data:b}).then(c.successResponse,c.errorResponse)},f.deleteSummaryEntry=function(b,e){return console.log("In costsummaryService.deleteSummaryEntry : ",b),c.triggerLoading(),a({method:"DELETE",url:d+"transactions/"+b,headers:{"X-USER-ID":e.id,"X-USER-TOKEN":e.authToken}}).then(c.successResponse,c.errorResponse)},f}]),angular.module("oasApp").factory("AccountsService",["$http","$upload","AuthService","ApiHandlerService",function(a,b,c,d){var e=d.getUrlPrefix(),f={};return f.accounts=[],f.getAccounts=function(b,g){return console.log("In accountsService.getAccounts",b),void 0===g&&c.retrieveSession(),d.triggerLoading(),a({method:"GET",url:e+"users/",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:b}).then(function(a){if(console.log("getAccounts response : ",a),b.page>1){var c=f.accounts.concat(a.data.users);angular.copy(c,f.accounts)}else angular.copy(a.data.users,f.accounts);return d.triggerLoaded(),a.data.num_pages})},f.addAccount=function(a,c){var f={};return console.log("In accountsService.addAccount",a),d.triggerLoading(),f={method:"POST",url:e+"users/",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:a.formDetails},a.file&&0!==a.file.length&&(f.file=a.file[0],f.fileFormDataName="avatar"),b.upload(f).then(d.successResponse,d.errorResponse)},f.updatePersonalAccount=function(a,f){console.log("In accountsService.updatePersonalAccount",a),void 0===f&&c.retrieveSession(),d.triggerLoading();var g={};return g={method:"PUT",url:e+"users/"+a.formDetails.id,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:JSON.parse(angular.toJson(a.formDetails))},0!==a.file.length&&(g.file=a.file[0],g.fileFormDataName="avatar"),b.upload(g).then(d.successResponse,d.errorResponse)},f.updateAccount=function(a,f){console.log("In accountsService.updateAccount",a),void 0===f&&c.retrieveSession(),d.triggerLoading();var g={};return g={method:"PUT",url:e+"users/"+a.formDetails.id,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:JSON.parse(angular.toJson(a.formDetails))},0!==a.file.length&&(g.file=a.file[0],g.fileFormDataName="avatar"),b.upload(g).then(d.successResponse,d.errorResponse)},f.changeRoles=function(b,c,f){return console.log("In accountsService.changeRoles",b,c),d.triggerLoading(),a({method:"PUT",url:e+"users/"+b,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},data:{roles:c}}).then(d.successResponse,d.errorResponse)},f.deleteAccount=function(b,c){return console.log("In accountsService.deleteAccount",b),d.triggerLoading(),a({method:"DELETE",url:e+"users/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(d.successResponse,d.errorResponse)},f}]),angular.module("oasApp").controller("NewaccountCtrl",["$rootScope","$scope","$timeout","AccountsService",function(a,b,c,d){b.newAccount={email:void 0,name:void 0,password:void 0,password_confirmation:void 0,position:void 0,avatar:void 0,roles:[]},b.newAccountRoleFlags={employee_profile:!1,employee_attendance:!1,salary:!1,allocation:!1,labor_cost:!1,material_cost:!1,project_cost:!1},b.$on("clear_newaccount",function(){b.newAccount={email:void 0,name:void 0,password:void 0,password_confirmation:void 0,position:void 0,avatar:void 0,roles:[]},b.newAccountRoleFlags={employee_profile:!1,employee_attendance:!1,salary:!1,allocation:!1,labor_cost:!1,material_cost:!1,project_cost:!1}}),b.addAccount=function(){console.log("Adding new account : ",b.newAccount),console.log("New account role flags : ",b.newAccountRoleFlags);var c=!1;angular.forEach(b.newAccountRoleFlags,function(a,d){a&&(b.newAccount.roles.push(d),c=!0)});var e={};e.formDetails=b.newAccount,e.file=b.selectedFile,d.addAccount(e,b.session.user).then(function(e){if(console.log("add account done",e),"success"===e.result){if(!c)return void a.$broadcast("update_accountsettings",!0);d.changeRoles(e.data.id,b.newAccount.roles,b.session.user).then(function(c){if("success"===c.result)return void a.$broadcast("update_accountsettings",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}else switch(e.status){case 422:console.error("422: ",e.data),b.launchErrorModal(e.data);break;case 401:a.$broadcast("not_authenticated")}})},b.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=FileAPI.html5),b.selectedImage=[],b.avatarThumb=null,b.onImageSelect=function(a){b.selectedImage=a},b.$watch("files",function(a){if(b.formUpload=!1,null!=a)for(var c=0;c<a.length;c++)b.errorMsg=null,function(a){b.generateThumb(a)}(a[c])}),b.generateThumb=function(a){null!=a&&b.fileReaderSupported&&a.type.indexOf("image")>-1&&c(function(){var d=new FileReader;d.readAsDataURL(a),d.onload=function(a){c(function(){b.avatarThumb=a.target.result})}})}}]).directive("newAccount",function(){return{templateUrl:"views/newaccountcard.html"}}),angular.module("oasApp").controller("AccessorysettingsCtrl",["$rootScope","$scope","$modal","$filter","MaterialsService",function(a,b,c,d,e){var f=function(a){a===b.accessoryParams.page?(console.log("accessory limit reached"),b.enableInfiniteScroll=!1):b.enableInfiniteScroll=!0};b.enableInfiniteScroll=!1,b.editAccessorySettings=!1,b.accessoryParams={name:void 0,page:1},b.newAccessory={name:void 0,price:void 0},b.materialsService=e,b.materialsService.accessories=e.accessories,b.$on("tab_changed",function(){$(".table-container").scrollTop(0),b.enableInfiniteScroll=!1}),b.$on("update_accessorysettings",function(a,c){console.log("update_accessorysettings triggered",c),c&&(b.enableInfiniteScroll=!1,b.accessoryParams={name:void 0,page:1},b.newAccessory={name:void 0,price:void 0}),b.materialsService.getAccessoriesList(b.accessoryParams,b.session.user).then(f)}),b.$on("accessories_search",function(a,c){console.log("accessory search triggered : ",c),b.enableInfiniteScroll=!1,b.accessoryParams.name=c,b.accessoryParams.page=1,b.materialsService.getAccessoriesList(b.accessoryParams,b.session.user).then(f)}),b.nextPage=function(){b.enableInfiniteScroll&&(console.log("accessory settings nextPage"),b.accessoryParams.page+=1,b.materialsService.getAccessoriesList(b.accessoryParams,b.session.user).then(f))},b.editMode=!1,b.addAccessory=function(){console.log("Adding new accessory : ",b.newAccessory),b.materialsService.addAccessory(b.newAccessory,b.session.user).then(function(c){if(console.log("add accessory done",c),"success"===c.result)return void a.$broadcast("update_accessorysettings",!0);switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.updateAccessory=function(c){console.log("updateAccessory : ",c),b.materialsService.updateAccessory(c,b.session.user).then(function(c){if(console.log("updateAccessory done",c),"success"!==c.result)switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.deleteAccessory=function(e){var f=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"accessory"}}}});f.result.then(function(c){c&&(console.log("Deleting accessory : ",e),b.materialsService.deleteAccessory(e,b.session.user).then(function(c){if("success"===c.result){console.log("delete accessory done",c);var f,g;return f=d("filter")(b.materialsService.accessories,{id:e}),g=b.materialsService.accessories.indexOf(f[0]),void b.materialsService.accessories.splice(g,1)}switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}}))})}}]).directive("settingsAccessories",function(){return{templateUrl:"views/accessorysettings.html"}}),angular.module("oasApp").factory("ApiHandlerService",["$rootScope","$http","$upload","$location","AuthService","HTTP_PARAMS",function(a,b,c,d,e,f){var g={};return g.getUrlPrefix=function(){return"mobility.oaspainting.com"===d.host()?f.prodApi:f.devApi},g.successResponse=function(a){console.log("in ApiHandlerService.successResponse");var b={};return b.result="success",b.data=a.data,g.triggerLoaded(),b},g.errorResponse=function(a){var b={};return b.result="failure",b.status=a.status,b.data=a.data.errors,g.triggerLoaded(),b},g.triggerLoading=function(){a.$broadcast("loading",!0)},g.triggerLoaded=function(){a.$broadcast("loading",!1)},g}]),angular.module("oasApp").controller("MaterialcostsummarymodalCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){a.projectName=c.projectName,a.data=c.data,a.cancel=function(){b.dismiss("cancel")}}]).directive("materialcostsummary-modal",function(){return{templateUrl:"views/modal/materialcostsummarymodal.html"}}),angular.module("oasApp").controller("AccessorycostsummarymodalCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){a.projectName=c.projectName,a.data=c.data,a.cancel=function(){b.dismiss("cancel")}}]).directive("accessorycostsummary-modal",function(){return{templateUrl:"views/modal/accessorycostsummarymodal.html"}}),angular.module("oasApp").controller("AttendancesummarymodalCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){console.log("AttendancesummarymodalCtrl modalInfo : ",c),a.employee=c.employee,a.month=c.month,a.year=c.year,a.data=c.data,a.cancel=function(){b.dismiss("cancel")}}]),angular.module("oasApp").controller("AttendancesummaryentryCtrl",["$scope",function(a){switch(a.entryIncomplete=!1,1===a.entry.incomplete&&(a.entryIncomplete=!0),a.entry.type_code){case 0:a.entry.color="red-bar";break;case 1:a.entry.color=1===a.entry.incomplete?"red-bar":"blue-bar";break;case 2:a.entry.color="green-bar";break;case 3:a.entry.color="green-bar";break;case 4:a.entry.color="purple-bar"}}]).directive("attendanceSummaryEntry",function(){return{templateUrl:"views/modal/attendancesummaryentry.html"}});